---
title: "Comparative Cognition Shuttlebox October 2018"
author: "Kelly Wallace"
date: "October 30, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#This shttlebox data is going to do a couple things differently than before:

#It's going to split the tank into thirds
#I'll measure both proportion time in the anticipatory "correct" side AND absolute distance form the "correct" screen
#It will compare the first three intervals to the last three (compare using an ANOVA- first 3 to last 3)
#The percent difference between the first three and the last three will be the continuous measure of performance

#Use Giveup 2 as the criterion but modified so I'm now calling it giveup3- if fish didn't change zones during 3 consecutive PRESENTATIONS (not during ISI's like last time)- But also I don't star applying the giveup criterion until 10 minutes in (for fish that need some time to get used to participating)- this translates to not starting the "giveup counter" until presentation 4

#criterion: distance/ proportion closer is greater than 20% based both as an absolute (i.e. the distance of the tank) or as a 20% INCREASE from whatever the distance/proportion was in the first 3 trials.

#I will still look at over the full 90 seconds, last 30 seconds, and last 10 seconds





```{r, echo=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(rmarkdown)
library(knitr)
library(readr)
library(utils)
library(EnvStats)
library(hqmisc)
library(MASS)

```



#NOW I"M GOING TO LOOK ONLY AT THE LAST 30 SECONDS OF THE GAP!








```{r, echo=FALSE, message=FALSE}


setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets/")

file_list<- list.files("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")


shuttleleft<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_L_framesofinterest.csv", col_names = TRUE, col_types = NULL)
#View(shuttleleft)

shuttleright<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_R_framesofinterest.csv", col_names = TRUE, col_types = NULL)
#View(shuttleright)

giveupdoc<-read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/shuttlebox_giveup_234.csv", col_names = TRUE, col_types = NULL)

test_column <- vector(length = length(file_list))
df.sum <- data.frame(fish_name = test_column)

rsquaredtxt <- (expression(r^2))
chisquaredtxt <- (expression(X^2))
fishertxt<- "Fisher's Exact Test p ="
```



```{r, echo=FALSE, message=FALSE}
for(i in 1:length(file_list)){
  setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")
  
  df<- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  
  fishname <- strsplit(file_list[i],'_')[[1]][4]
  startside <- strsplit(file_list[i],'_')[[1]][5]
  giveup3<-giveupdoc$giveup3[i]
  giveup4<-giveupdoc$giveup4[i]
 #giveup 2 is the more restricted version of giveup- this is the last tgap before 3 sequential gaps where the fish did not move. This was judged by the proportion of time on the correct side, if it went 0-100-0 or 100-0-100.
  
  #here's where I'm going to add the giveup3- which is giveup 2 but we only start looking starting on the 4th presentation and we look DURING STIMS not GAPS. The idea is that it might take a while for a fish to not be scared so we're giving them the first 3 trials (i.e. 5 minutes) to get used to it. the first trial that can count towards the giveup is trial 4
  
  #e.g. if 0-100-0 is presentations (stim) 17,18,19, then giveup presentation is 16
  
  #NOTE ABOUT GIVEUP 3- when we use giveup 3 and the 3v3, there are X fish who cannot participate because they don't have 6 ISI's in which to score the first 3 vs the last 3 (i.e. they give up before trial 6)
  #Now given giveup3, where the fish stops being counted if it doesn't participate for three tirals in a row but only after the first 4, it's easy to say what the last three trials before the giveup are, but what are the first 3? Are they trials 1,2,3 or are they trials 4,5,6? I'm going to use 1,2,3 for now, but understand that I could use 4,5,6. I don't have a record right now of if the fish participated in the first 3 trials. I only started looking at trial 4. 
  
  
  #I'm going to now make a giveup4 criterion: which is if the fish stayed on the same 10cm screen zone (either left or right) for three consecutive STIMS. This is the same as giveup3 except in two ways: instead of useing a third of the tank we're using the closest 10cm on either end and ALSO we're going to start counting the giveup at trial 2 instead of trial 4. Remember the the actual giveup is the LAST presentation before the three consecutive. So like above if the fish did not move for stims 6,7, and 8, the giveup4 is 5. So the earliest a fish could not participate is trials 2,3,4 which means their giveup is 1. Remember we need at least three consecutive trials for a fish to be considered a learner, so previously we were not including fish whose giveup3 was less than 6. Now we'll not include fish whose giveup4 is less than 4 (their learning)
  
  
  
  resolution <- strsplit(file_list[i],'_')[[1]][7]
  
  #converting all the non-1280 resolutions to 1280 as far as x distance goes
  if(resolution == 800){
  df$x <- df$x *1.6}
  if (resolution == 640){
  df$x <- df$x *2}
  max(df$x, na.rm = TRUE)
  
  if(startside == "L"){
    df.full<- full_join(df,shuttleleft, by = 'frame_number')}
  else if(startside == "R"){
    df.full<- full_join(df,shuttleright, by = 'frame_number')}
  
  df.full<-df.full %>% mutate(distance_from_correct = abs(correct_x_pixel - x))
  
  #This section will determine if a fish participated or not. The criterion I'm using for now is if a fish spent 80% of their time on one side (either left or right, independent of where the stimului previously was) during gaps 4-9 (so 10 minutes) (and note that this is the full 90 seconds of the gap!)


df.participation <- df.full %>%filter(type == 'gap') %>% filter(is.inrange(presentation, range = c(4,9)))
df.participation<-df.participation %>% mutate(fish_location_third_of_tank = NA) 
df.participation<-df.participation %>% mutate(fish_location_10cm = NA)

for (a in 1:nrow(df.participation)){
  if(is.na(df.participation$x[a]) == TRUE){
    df.participation$fish_location_third_of_tank[a] <- NA}
  else if(df.participation$x[a]<=427){
    df.participation$fish_location_third_of_tank[a] <- 'left'}
  else if(df.participation$x[a]>=783){
    df.participation$fish_location_third_of_tank[a] <- 'right'}
  else if(between(df.participation$x[a],428,782) == TRUE){
    df.participation$fish_location_third_of_tank[a] <- 'center'} 
}

for (a in 1:nrow(df.participation)){
  if(is.na(df.participation$x[a]) == TRUE){
    df.participation$fish_location_10cm[a] <- NA}
  else if(df.participation$x[a]<=246){
    df.participation$fish_location_10cm[a] <- 'left'}
  else if(df.participation$x[a]>=1034){
    df.participation$fish_location_10cm[a] <- 'right'}
  else if(between(df.participation$x[a],245,1033) == TRUE){
    df.participation$fish_location_10cm[a] <- 'center'} 
}


proportion_time_on_left_third_across_gaps_4_through_9 <- nrow(df.participation %>%filter(fish_location_third_of_tank == 'left')) / nrow(df.participation %>%filter(is.na(fish_location_third_of_tank) == FALSE))
proportion_time_on_right_third_across_gaps_4_through_9 <- nrow(df.participation %>%filter(fish_location_third_of_tank == 'right')) / nrow(df.participation %>%filter(is.na(fish_location_third_of_tank) == FALSE))
proportion_time_on_center_third_across_gaps_4_through_9 <- nrow(df.participation %>%filter(fish_location_third_of_tank == 'center')) / nrow(df.participation %>%filter(is.na(fish_location_third_of_tank) == FALSE))


proportion_time_on_left_10cm_across_gaps_4_through_9 <- nrow(df.participation %>%filter(fish_location_10cm == 'left')) / nrow(df.participation %>%filter(is.na(fish_location_10cm) == FALSE))
proportion_time_on_right_10cm_across_gaps_4_through_9 <- nrow(df.participation %>%filter(fish_location_10cm == 'right')) / nrow(df.participation %>%filter(is.na(fish_location_10cm) == FALSE))
proportion_time_on_center_10cm_across_gaps_4_through_9 <- nrow(df.participation %>%filter(fish_location_10cm == 'center')) / nrow(df.participation %>%filter(is.na(fish_location_10cm) == FALSE))

#Here's where I'll get the value of did the fish participate criterion 3 and 4- did they make any transits between the leftmost third and the rightmost third (then 10cm) at some point in gaps 4-9

if (nrow(df.participation %>%filter(fish_location_third_of_tank == 'left')) >=1 & nrow(df.participation %>%filter(fish_location_third_of_tank == 'right')) >= 1){
  did_fish_participate_criterion3 <- 1
}
else if ((proportion_time_on_left_third_across_gaps_4_through_9 + proportion_time_on_right_third_across_gaps_4_through_9 + proportion_time_on_center_third_across_gaps_4_through_9) !=1) {
  did_fish_participate_criterion3 <- NA
}
else {
  did_fish_participate_criterion3 <- 0
}


if (nrow(df.participation %>%filter(fish_location_10cm == 'left')) >=1 & nrow(df.participation %>%filter(fish_location_10cm == 'right')) >= 1){
  did_fish_participate_criterion4 <- 1
}
else if ((proportion_time_on_left_10cm_across_gaps_4_through_9 + proportion_time_on_right_10cm_across_gaps_4_through_9 + proportion_time_on_center_10cm_across_gaps_4_through_9) !=1) {
  did_fish_participate_criterion4 <- NA
}
else {
  did_fish_participate_criterion4 <- 0
}

# average number of transits during the entire task, stims and gaps
df.participation.total <- df.full %>%filter(type == 'gap')
df.participation.total<-df.participation.total %>% mutate(fish_location_third_of_tank = NA) 
df.participation.total<-df.participation.total %>% mutate(fish_location_10cm = NA)

for (a in 1:nrow(df.participation.total)){
  if(is.na(df.participation.total$x[a]) == TRUE){
    df.participation.total$fish_location_third_of_tank[a] <- NA}
  else if(df.participation.total$x[a]<=427){
    df.participation.total$fish_location_third_of_tank[a] <- 'left'}
  else if(df.participation.total$x[a]>=783){
    df.participation.total$fish_location_third_of_tank[a] <- 'right'}
  else if(between(df.participation.total$x[a],428,782) == TRUE){
    df.participation.total$fish_location_third_of_tank[a] <- 'center'} 
}

for (a in 1:nrow(df.participation.total)){
  if(is.na(df.participation.total$x[a]) == TRUE){
    df.participation.total$fish_location_10cm[a] <- NA}
  else if(df.participation.total$x[a]<=246){
    df.participation.total$fish_location_10cm[a] <- 'left'}
  else if(df.participation.total$x[a]>=1034){
    df.participation.total$fish_location_10cm[a] <- 'right'}
  else if(between(df.participation.total$x[a],245,1033) == TRUE){
    df.participation.total$fish_location_10cm[a] <- 'center'} 
}

df.transits<-data.frame(presentation = vector(length = 30), did_fish_transit_during_this_gap = vector(length = 30))
for (m in 1:30){
  df.transits$presentation[m] <- m
if (nrow(df.participation.total %>%filter(presentation == m) %>%filter(fish_location_10cm == 'left')) >=1 & nrow(df.participation.total %>%filter(presentation == m) %>%filter(fish_location_10cm == 'right')) >= 1){df.transits$did_fish_transit_during_this_gap[m]<- 1}
else{df.transits$did_fish_transit_during_this_gap[m]<- 0}
}

m<-1
for (m in 1:29){ 
if (nrow(df.participation.total %>%filter(presentation == m) %>%filter(fish_location_10cm == 'left')) >=1 & nrow(df.participation.total %>%filter(presentation == m+1) %>%filter(fish_location_10cm == 'right')) >= 1){df.transits$did_fish_transit_by_next_gap[m]<- 1} 
else if (nrow(df.participation.total %>%filter(presentation == m) %>%filter(fish_location_10cm == 'right')) >=1 & nrow(df.participation.total %>%filter(presentation == m+1) %>%filter(fish_location_10cm == 'left')) >= 1){df.transits$did_fish_transit_by_next_gap[m]<- 1}
else{df.transits$did_fish_transit_by_next_gap[m]<- 0}  
}


number_of_gaps_in_which_the_fish_transited_during_the_gap <- sum(df.transits$did_fish_transit_during_this_gap)
number_of_gaps_in_which_the_fish_transited_between_two_sequential_gaps <- sum(df.transits$did_fish_transit_by_next_gap)

###############################gaps 1 through 6
df.participation2 <- df.full %>%filter(type == 'stim') %>% filter(is.inrange(presentation, range = c(1,6)))
df.participation2<-df.participation2 %>% mutate(fish_location_third_of_tank = NA) 
df.participation2<-df.participation2 %>% mutate(fish_location_10cm = NA)

for (c in 1:nrow(df.participation2)){
  if(is.na(df.participation2$x[c]) == TRUE){
    df.participation2$fish_location_third_of_tank[c] <- NA}
  else if(df.participation2$x[c]<=427){
    df.participation2$fish_location_third_of_tank[c] <- 'left'}
  else if(df.participation2$x[c]>=783){
    df.participation2$fish_location_third_of_tank[c] <- 'right'}
  else if(between(df.participation2$x[c],428,782) == TRUE){
    df.participation2$fish_location_third_of_tank[c] <- 'center'} 
}

for (c in 1:nrow(df.participation2)){
  if(is.na(df.participation2$x[c]) == TRUE){
    df.participation2$fish_location_10cm[c] <- NA}
  else if(df.participation2$x[c]<=246){
    df.participation2$fish_location_10cm[c] <- 'left'}
  else if(df.participation2$x[c]>=1034){
    df.participation2$fish_location_10cm[c] <- 'right'}
  else if(between(df.participation2$x[c],245,1033) == TRUE){
    df.participation2$fish_location_10cm[c] <- 'center'} 
}

proportion_time_on_left_10cm_across_stims_1_through_6 <- nrow(df.participation2 %>%filter(fish_location_10cm == 'left')) / nrow(df.participation2 %>%filter(is.na(fish_location_10cm) == FALSE))
##################


###
df.full.stim<-df.full %>% filter(type == 'stim')
    df.full<-df.full%>%filter(last_30_secs_of_gap == 1) #THIS IS WHAT CHANGES THE WHOLE THING TO FILTER BY LAST 30 SECS
  
  df.full.gap<-df.full %>% filter(type == 'gap')
  
  
  df.full.gap1<-df.full.gap %>% filter(is.inrange(presentation, range = c(1,3)))
  df.full.gap2<-df.full.gap %>% filter(is.inrange(presentation, range = c(4,6)))
  df.full.gap3<-df.full.gap %>% filter(is.inrange(presentation, range = c(7,9)))
  df.full.gap4<-df.full.gap %>% filter(is.inrange(presentation, range = c(10,12)))
  df.full.gap5<-df.full.gap %>% filter(is.inrange(presentation, range = c(13,15)))
  df.full.gap6<-df.full.gap %>% filter(is.inrange(presentation, range = c(16,18)))
  df.full.gap7<-df.full.gap %>% filter(is.inrange(presentation, range = c(19,21)))
  df.full.gap8<-df.full.gap %>% filter(is.inrange(presentation, range = c(22,24)))
  df.full.gap9<-df.full.gap %>% filter(is.inrange(presentation, range = c(25,27)))
  df.full.gap10<-df.full.gap %>% filter(is.inrange(presentation, range = c(28,30)))
  
  
df.full.gap<-do.call("rbind", list(df.full.gap1, df.full.gap2, df.full.gap3, df.full.gap4, df.full.gap5, df.full.gap6, df.full.gap7, df.full.gap8, df.full.gap9, df.full.gap10))
  

  #This section is getting the proportion of time on the correct side for every presentation (first for gaps and then for stimuli)
  test_column_prop_gap <- vector(length = length(unique(df.full.gap$presentation)))
  df.prop.gap<-data.frame(presentation = test_column_prop_gap)
  test_column_prop_stim <- vector(length = length(unique(df.full.gap$presentation)))
  df.prop.stim<-data.frame(presentation = test_column_prop_stim) %>%mutate(proportion_time_10cm_during_stim = test_column_prop_stim)
  
  for(m in 1:length(unique(df.full.gap$presentation))){
    mnum<-as.numeric(m)
    df.prop.stim$presentation[m] <-mnum
    nrow<-df.full.stim %>% filter(presentation == mnum) %>% nrow()
    correct_nrow<-df.full.stim %>% filter(presentation == mnum) %>% filter(distance_from_correct < 246) %>% nrow()
    df.prop.stim$proportion_time_10cm_during_stim[m]<-correct_nrow/nrow
  }
 
  df.prop.stim49<-df.prop.stim %>% filter(is.inrange(presentation, range = c(4,9)))
  prop_within_10cm_during_all_stims<-median(df.prop.stim$proportion_time_10cm_during_stim)
  prop_within_10cm_during_stims_4_through_9<-median(df.prop.stim49$proportion_time_10cm_during_stim)
  
  #here's where I'm going to figure out participation criterion #5- A fish is participatory if they entered the 10cm closest to the screen DURING STIM for at least 3 stims out of stims 2-7
  counter <- 0
  df.full.stim27<-df.full.stim %>% filter(is.inrange(presentation, range = c(2,7)))
  for(p in 1:length(df.full.stim27)){
    pnum<-as.numeric(p)
    nrow<-df.full.stim27 %>% filter(presentation == pnum) %>% filter(distance_from_correct <= 246) %>% nrow()
    if (nrow > 0){
    counter <- counter + 1  
    }
  }
  
  if(is.na(counter)== TRUE){
    did_fish_participate_criterion5 <- NA}
  else if(counter >= 3){
    did_fish_participate_criterion5 <- 1}
  else{
    did_fish_participate_criterion5 <- 0}
  
  if(is.na(counter)== TRUE){
    did_fish_participate_criterion6 <- NA}
  else if(counter >= 4){
    did_fish_participate_criterion6 <- 1}
  else{
    did_fish_participate_criterion6 <- 0}
  
  
  df.full.stim16left<-df.full.stim %>% filter(is.inrange(presentation, range = c(1,6))) %>%filter(correct_side == 'L') %>%filter(distance_from_correct <=246)
  df.full.stim16right<-df.full.stim %>% filter(is.inrange(presentation, range = c(1,6))) %>%filter(correct_side == 'R') %>%filter(distance_from_correct <=246)
  

  
  if((nrow(df.full.stim16left) > 0) & (nrow(df.full.stim16right) > 0)) {
    did_fish_participate_criterion7 <-1}
  else{
    did_fish_participate_criterion7<- 0}
     
  #427 is going to be the closest third to the screen (1280 width)
  for(j in 1:length(unique(df.full.gap$presentation))){
    jnum<-as.numeric(j)
    df.prop.gap$presentation[j] <-jnum
    df.full.gap.this.presentation<-df.full.gap %>% filter(presentation == jnum)
    nrow<-df.full.gap %>% filter(presentation == jnum) %>% nrow()
    correct_nrow<-df.full.gap %>% filter(presentation == jnum) %>% filter(distance_from_correct < 427) %>% nrow()
    df.prop.gap$proportion_time_correct_during_gap[j]<-correct_nrow/nrow
    
  
########################################
#adding here the part about WITHIN 10cm:
########################################
#Adding a new criterion(based on the phone convo with Molly 12/6):

#I'm going to measure "proportion of time" within 10 cm (1280 pixels = 52 cm, so 10cm = 246 pixels) during the last 30 seconds of the ISI
#Number of observations to get positional data during the last 30 seconds of the ISI: 6
#CRITERION- did fish reach a 50% (3 out of 6 observations) proportion time within 10cm of the correct screen for 3 ISI in a row (before they gave up)
#continuous measure: if you learned, at what ISI did you meet the criterion
#so I'll get two new columns out of this:
  #1. did fish meet learning criterion of 50% (3 out of 6 observations) proportion time within 10cm (246 pixels) of the correct screen for 3 ISI in a row?
  #2. If so, what was the speed of learning 50 percent within 10cm for 3 ISI (ie. at what ISI was the criteino met?)

    
    within10cm_nrow<-df.full.gap%>% filter(presentation == jnum) %>% filter(distance_from_correct < 246) %>% nrow()
    df.prop.gap$proportion_time_within10cm_during_gap[j]<-within10cm_nrow/nrow 
    
    #new december 2019
    within10cm_correct_screentime_nrow <-df.full.gap%>% filter(presentation == jnum) %>% filter(distance_from_correct < 246) %>% nrow()
    screentime_nrow <-df.full.gap%>% filter(presentation == jnum) %>% filter(distance_from_correct <= 246 | distance_from_correct >=1034) %>% nrow()
    
    df.prop.gap$proportion_time_within10cm_during_gap_OFSCREENTIME[j]<-within10cm_correct_screentime_nrow/screentime_nrow 
    
    
    df.prop.gap$average_distance_during_gap[j] <- mean(df.full.gap.this.presentation$distance_from_correct)
  }
  
  mean_prop_time_correct_during_gap<-mean(df.prop.gap$proportion_time_correct_during_gap) #these are just across all gaps, not a performance measure
  mean_prop_time_within10cm_during_gap<- mean(df.prop.gap$proportion_time_within10cm_during_gap) #these are just acros all gaps, not a performance measure
  mean_distance_from_correct_during_gap<-mean(df.prop.gap$average_distance_during_gap)
  
  df.prop.gap<-df.prop.gap%>% filter(is.na(presentation) == FALSE)

  mod<- lm(df.prop.gap$proportion_time_correct_during_gap ~ df.prop.gap$presentation)
  modsum<-summary(mod)
  modsum<-modsum$coefficients
  gap_prop_slope<-modsum[2]
  
  giveup3minus2 <- giveup3 - 2
  giveup4minus2 <- giveup4 - 2
  


  #so here is where I'm going to get the info that determines when, if ever, did you meet a criterion of 60% on the correct side during the last 30secs of gaps for 3 consecutive trials.
  df.prop.gap<- df.prop.gap %>% mutate(is_prop_gap_above_60 = NA)
  df.prop.gap<- df.prop.gap %>% mutate(is_prop_gap_above_90 = NA)
  df.prop.gap<- df.prop.gap %>% mutate(is_prop_gap_within10cm_above_50 = NA)

  
for(k in 1:giveup4){ 
  if (df.prop.gap$proportion_time_correct_during_gap[k] >= 0.6){
    df.prop.gap$is_prop_gap_above_60[k]<- 1}
  else if (df.prop.gap$proportion_time_correct_during_gap[k] < 0.6){
    df.prop.gap$is_prop_gap_above_60[k]<- 0}
  else{
    df.prop.gap$is_prop_gap_above_60[k]<- NA}
}
  for(k in 1:giveup4){ 
  if (df.prop.gap$proportion_time_correct_during_gap[k] >= 0.9){
    df.prop.gap$is_prop_gap_above_90[k]<- 1}
  else if (df.prop.gap$proportion_time_correct_during_gap[k] < 0.9){
    df.prop.gap$is_prop_gap_above_90[k]<- 0}
  else{
    df.prop.gap$is_prop_gap_above_90[k]<- NA}
  }
  
  #adding the within10cm measure###
 for(k in 1:giveup4){ 
   if (df.prop.gap$proportion_time_within10cm_during_gap[k] > 0.5){
    df.prop.gap$is_prop_gap_within10cm_above_50[k]<- 1}
   if (df.prop.gap$proportion_time_within10cm_during_gap[k] < 0.5){
    df.prop.gap$is_prop_gap_within10cm_above_50[k]<- 0}
   if (df.prop.gap$proportion_time_within10cm_during_gap[k] == 0.5){
    df.prop.gap$is_prop_gap_within10cm_above_50[k]<- 1}
 }
  #######################

 count <- 0 
  for(k in 2:giveup4){  
    if(is.na(df.prop.gap$is_prop_gap_above_60[k])== TRUE){
     df.prop.gap$consecutive_gaps_above_60[k]<- NA}
    else if (df.prop.gap$is_prop_gap_above_60[k]== 1){
      count <- count + 1
      df.prop.gap$consecutive_gaps_above_60[k]<- count}
    else if (df.prop.gap$is_prop_gap_above_60[k]== 0){
      count <- 0 
      df.prop.gap$consecutive_gaps_above_60[k]<- count}
   else {
      df.prop.gap$consecutive_gaps_above_60[k]<- NA}
  }
  
 
  count <- 0 
  for(k in 2:giveup4){  
    if(is.na(df.prop.gap$is_prop_gap_above_90[k])== TRUE){
     df.prop.gap$consecutive_gaps_above_90[k]<- NA}
    else if (df.prop.gap$is_prop_gap_above_90[k]== 1){
      count <- count + 1
      df.prop.gap$consecutive_gaps_above_90[k]<- count}
    else if (df.prop.gap$is_prop_gap_above_90[k]== 0){
      count <- 0 
      df.prop.gap$consecutive_gaps_above_90[k]<- count}
   else {
      df.prop.gap$consecutive_gaps_above_90[k]<- NA}
  }
  
  #within 10cm measure
  count <- 0 
  for(k in 2:giveup4){  
    if(is.na(df.prop.gap$is_prop_gap_within10cm_above_50[k])== TRUE){
     df.prop.gap$consecutive_gaps_within10cm_above_50[k]<- NA}
    else if (df.prop.gap$is_prop_gap_within10cm_above_50[k]== 1){
      count <- count + 1
      df.prop.gap$consecutive_gaps_within10cm_above_50[k]<- count}
    else if (df.prop.gap$is_prop_gap_within10cm_above_50[k]== 0){
      count <- 0 
      df.prop.gap$consecutive_gaps_within10cm_above_50[k]<- count}
   else {
      df.prop.gap$consecutive_gaps_within10cm_above_50[k]<- NA}
  }
    
    
  
  df.prop.gap.60criterion<- df.prop.gap%>%filter(consecutive_gaps_above_60 == 3)
  df.prop.gap.90criterion<- df.prop.gap%>%filter(consecutive_gaps_above_90 == 2)
  df.prop.gap.50criterionwithin10cm<-df.prop.gap%>%filter(consecutive_gaps_within10cm_above_50 == 3)
  
  if (nrow(df.prop.gap.60criterion) == 0){
    did_fish_meet_60_percent_3_consecutive_criterion <- 0}
  else if (nrow(df.prop.gap.60criterion) > 0){
    did_fish_meet_60_percent_3_consecutive_criterion <- 1}

  if (nrow(df.prop.gap.90criterion) == 0){
    did_fish_meet_90_percent_2_consecutive_criterion <- 0}
  else if (nrow(df.prop.gap.90criterion) > 0){
    did_fish_meet_90_percent_2_consecutive_criterion <- 1}
  
    if (nrow(df.prop.gap.50criterionwithin10cm) == 0){
    did_fish_meet_within10cm_50_percent_3_consecutive_criterion <- 0}
  else if (nrow(df.prop.gap.50criterionwithin10cm) > 0){
    did_fish_meet_within10cm_50_percent_3_consecutive_criterion <- 1}
  
  
  speed_of_learning_60_percent_3_consecutive_criterion <- df.prop.gap.60criterion$presentation[1]
  speed_of_learning_90_percent_2_consecutive_criterion <- df.prop.gap.90criterion$presentation[1]
  speed_of_learning_within10cm_50_percent_3_consecutive_criterion <- df.prop.gap.50criterionwithin10cm$presentation[1]
  
    if(is.na(speed_of_learning_60_percent_3_consecutive_criterion) == TRUE){
    speed_of_learning_60_percent_3_consecutive_criterion <- NA}
    else if (speed_of_learning_60_percent_3_consecutive_criterion > giveup4){
    speed_of_learning_60_percent_3_consecutive_criterion <- NA}
  
    if(is.na(speed_of_learning_90_percent_2_consecutive_criterion) == TRUE){
    speed_of_learning_90_percent_2_consecutive_criterion <- NA}
    else if (speed_of_learning_90_percent_2_consecutive_criterion > giveup4){
    speed_of_learning_90_percent_2_consecutive_criterion <- NA}
  
    if(is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion) == TRUE){
    speed_of_learning_within10cm_50_percent_3_consecutive_criterion <- NA}
    else if (speed_of_learning_within10cm_50_percent_3_consecutive_criterion > giveup4){
    speed_of_learning_within10cm_50_percent_3_consecutive_criterion <- NA}

  
  #here's where I'm going to make two new performnace metrics, one categorical and one continuous:
  #categorical, OF TIME SPENT AT THE SCREENS, did you meet a criterion of 50% in the correct 10cm (last 30 seconds of gap) for at least 3 gaps in a row
  
  #so this is going to be measured as  time spent in front of the correct screen, divided by time spent at the correct screen plus time spent at the incorrect screen.
  #if you met the criterion,, what was your median "choosing score" ie the median of your 3 scores? a 50 would be random and a 1 would be the highest possible learning
  df.screen<-data.frame(presentation =vector(length = 30))
  for(d in 2:giveup4){  
    nrowcorr<-df.full.gap%>%filter(presentation == d) %>% filter(distance_from_correct <247) %>% nrow()
    nrowincorr<-df.full.gap%>%filter(presentation == d) %>% filter(distance_from_correct > 1033) %>% nrow()
    df.screen$presentation[d] <- d
    df.screen$prop_within_10cm_of_time_spent_at_screen[d] <- nrowcorr/(nrowcorr+nrowincorr)
  }
  
  countscreen <-0
  for(e in 1:nrow(df.screen)){
    if(is.na(df.screen$prop_within_10cm_of_time_spent_at_screen[e]) == TRUE){
     countscreen <- 0
     df.screen$consecutive_gaps_above_of_screen_time_50[e]<- countscreen}
  else if (df.screen$prop_within_10cm_of_time_spent_at_screen[e] > 0.5) {
  countscreen<- countscreen + 1
  df.screen$consecutive_gaps_above_of_screen_time_50[e]<- countscreen}
  else{
  countscreen <- 0
  df.screen$consecutive_gaps_above_of_screen_time_50[e]<- countscreen}
  }
  
  if (max(df.screen$consecutive_gaps_above_of_screen_time_50) >= 3){
    did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive <- 1}
  else{
    did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive <- 0}

#added december 2019 now 80% 3 consecutive  
    countscreen <-0
  for(e in 1:nrow(df.screen)){
    if(is.na(df.screen$prop_within_10cm_of_time_spent_at_screen[e]) == TRUE){
     countscreen <- 0
     df.screen$consecutive_gaps_above_of_screen_time_80[e]<- countscreen}
  else if (df.screen$prop_within_10cm_of_time_spent_at_screen[e] > 0.8) {
  countscreen<- countscreen + 1
  df.screen$consecutive_gaps_above_of_screen_time_80[e]<- countscreen}
  else{
  countscreen <- 0
  df.screen$consecutive_gaps_above_of_screen_time_80[e]<- countscreen}
  }
  
  if (max(df.screen$consecutive_gaps_above_of_screen_time_80) >= 3){
    did_fish_learn_OF_SCREEN_TIME_80_percent_within_10_cm_3_consecutive <- 1}
  else{
    did_fish_learn_OF_SCREEN_TIME_80_percent_within_10_cm_3_consecutive <- 0}
    
    
    
  #added december 19 now 50% 4 consecutive
    countscreen <-0
  for(e in 1:nrow(df.screen)){
    if(is.na(df.screen$prop_within_10cm_of_time_spent_at_screen[e]) == TRUE){
     countscreen <- 0
     df.screen$consecutive_gaps_above_of_screen_time_50[e]<- countscreen}
  else if (df.screen$prop_within_10cm_of_time_spent_at_screen[e] > 0.5) {
  countscreen<- countscreen + 1
  df.screen$consecutive_gaps_above_of_screen_time_50[e]<- countscreen}
  else{
  countscreen <- 0
  df.screen$consecutive_gaps_above_of_screen_time_50[e]<- countscreen}
  }
  
  if (max(df.screen$consecutive_gaps_above_of_screen_time_50) >= 4){
    did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_4_consecutive <- 1}
  else{
    did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_4_consecutive <- 0}
  
  
  
  
  
  ###
   if(giveup4 > 3){
    df.full.first3gap<-df.full.gap %>% filter(is.inrange(presentation, range = c(1,3)))
    df.full.last3gap<-df.full.gap %>% filter(is.inrange(presentation, range = c(giveup4minus2, giveup4)))
    
    df.prop.first3gap<-df.prop.gap %>% filter(is.inrange(presentation, range = c(1,3)))
    df.prop.last3gap<-df.prop.gap %>% filter(is.inrange(presentation, range = c(giveup4minus2, giveup4)))
    df.prop.gap6<-df.prop.gap %>% filter(presentation == 6)
    df.prop.gap456<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(4,6)))
    df.prop.gap567<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(5,7)))
    df.prop.gap678<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(6,8)))
    df.prop.gap789<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(7,9)))
    df.prop.gap8910<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(8,10)))
    df.prop.gap91011<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(9,11)))
    df.prop.gap101112<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(10,12)))
    df.prop.gap111213<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(11,13)))
    df.prop.gap121314<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(12,14)))
    df.prop.gap131415<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(13,15)))
    df.prop.gap141516<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(14,16)))
    df.prop.gap151617<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(15,17)))
    df.prop.gap161718<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(16,18)))
    df.prop.gap171819<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(17,19)))
    df.prop.gap181920<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(18,20)))
    df.prop.gap192021<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(19,21)))
    df.prop.gap202122<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(20,22)))
    df.prop.gap212223<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(21,23)))
    df.prop.gap222324<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(22,24)))
    df.prop.gap232425<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(23,25)))
    df.prop.gap242526<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(24,26)))
    df.prop.gap252627<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(25,27)))
    df.prop.gap262728<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(26,28)))
    df.prop.gap272829<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(27,29)))
    df.prop.gap282930<-  df.prop.gap %>% filter(is.inrange(presentation, range = c(28,30)))
    
    if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap456$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 4}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap567$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 5}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap678$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 6}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap789$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 7}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap8910$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 8}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap91011$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 9}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap101112$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 10}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap111213$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 11}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap121314$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 12}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap131415$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 13}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap141516$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 14}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap151617$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 15}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap161718$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 16}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap171819$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 17}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap181920$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 18}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap192021$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 19}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap202122$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 20}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap212223$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 21}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap222324$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 22}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap232425$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 23}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap242526$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 24}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap252627$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 25}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap262728$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 26}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap272829$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 27}
    else if(mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap282930$proportion_time_correct_during_gap) <= -0.2){
    prop_20percent_solvetrial<- 28}
    else{
      prop_20percent_solvetrial <- NA}
    
    
    average_proportion_within_10cm_gaps_456<-mean(df.prop.gap456$proportion_time_within10cm_during_gap)
    comp123_v_456_avg_prop_within10cm_OFSCREENTIME <- mean(df.prop.first3gap$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE) - mean(df.prop.gap456$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE)
    
    
    avg_dist_during_first_3_gaps<- mean(df.full.first3gap$distance_from_correct)
    comp_3v3_avg_dist <- mean(df.full.first3gap$distance_from_correct) - mean(df.full.last3gap$distance_from_correct)
    
    twenty_percent_of_first_3_avg_dist <- (mean(df.full.first3gap$distance_from_correct)) * 0.2
    
    comp_3v3_avg_prop_correct <- mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.last3gap$proportion_time_correct_during_gap)
    comp_123_v_456_avg_prop_correct <- mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.gap456$proportion_time_correct_during_gap)
    comp_123_v_6_avg_prop_correct <- mean(df.prop.first3gap$proportion_time_correct_during_gap) - df.prop.gap6$proportion_time_correct_during_gap
    
    comp_3v3_avg_prop_within_10cmlast_30_secs <-mean(df.prop.first3gap$proportion_time_within10cm_during_gap) - mean(df.prop.last3gap$proportion_time_within10cm_during_gap)
    
    comp_3v3_avg_prop_within_10cmlast_30_secs_OFSCREENTIME<-mean(df.prop.first3gap$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE) - mean(df.prop.last3gap$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE)
    
    comp_123_v_282930_within10cm_last_30_secs <- mean(df.prop.first3gap$proportion_time_within10cm_during_gap, na.rm = TRUE) - mean(df.prop.gap282930$proportion_time_within10cm_during_gap, na.rm = TRUE)
      
    comp_123_v_282930_within10cm_last_30_secs_OFSCREENTIME <- mean(df.prop.first3gap$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE) - mean(df.prop.gap282930$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE)
    

 #here's where I'm going to do the ANOVA comparing the 6 relevant gaps (first 3 and last 3) PROP 
  #I'm also going to do a t test/shapiro where compare the first 3 to the last 3 PROP
  df.prop.first3gap<- df.prop.first3gap %>% mutate(first_or_last = 'first')
  df.prop.last3gap<- df.prop.last3gap %>% mutate(first_or_last = 'last') 
  df.prop.firstANDlast3gap<- rbind(df.prop.first3gap, df.prop.last3gap) 
 
  #here's the ANOVA (kruskal), but this doesnt make sense because I'm not binning so there's only one value per presentation
#df.prop.firstANDlast3gap$presentation<-as.factor(df.prop.firstANDlast3gap$presentation)  
#kruskalfit<-kruskal.test(proportion_time_correct_during_gap ~ presentation, data=df.prop.firstANDlast3gap)
#prop_p_value_kruskal<- kruskalfit$p.value  
     
#shapiro<- shapiro.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap) #if it is non-significant, it does not deviate from normality, so use a t test  
#prop_p_value_shapiro<- shapiro %>% broom::tidy() %>% select(p.value) %>% unlist
#test<-t.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap~df.prop.firstANDlast3gap$first_or_last)
#prop_p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
#wilcox_test<-wilcox.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap~df.prop.firstANDlast3gap$first_or_last)
#prop_p_value_wilcox<-wilcox_test$p.value


#Now I'm going to do the same ANOVA/t-test but use distance from correct screen rather than 
#shapiro<- shapiro.test(df.prop.firstANDlast3gap$average_distance_during_gap) #if it is non-significant, it does not deviate from normality, so use a t test  
#dist_p_value_shapiro<- shapiro %>% broom::tidy() %>% select(p.value) %>% unlist
#test<-t.test(df.prop.firstANDlast3gap$average_distance_during_gap~df.prop.firstANDlast3gap$first_or_last)
#dist_p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
#wilcox_test<-wilcox.test(df.prop.firstANDlast3gap$average_distance_during_gap~df.prop.firstANDlast3gap$first_or_last)
#dist_p_value_wilcox<-wilcox_test$p.value  

    }
  
  else if(giveup4<=3){
    comp_3v3_avg_dist <- NA
    comp_3v3_avg_prop_correct <- NA
    comp_123_v_456_avg_prop_correct <- NA
    comp_123_v_6_avg_prop_correct <- NA
    prop_20percent_solvetrial <- NA
    average_proportion_within_10cm_gaps_456 <- NA
    did_fish_meet_60_percent_3_consecutive_criterion <- NA
    did_fish_meet_90_percent_2_consecutive_criterion <- NA
    did_fish_meet_within10cm_50_percent_3_consecutive_criterion <- NA
    #prop_p_value_shapiro <- NA
    #prop_p_value_t <- NA
    #prop_p_value_wilcox <- NA
    #dist_p_value_shapiro <- NA
    #dist_p_value_t <- NA
    #dist_p_value_wilcox <- NA
    }

  
 #now let's put it all together
df.sum$fish_name[i] <-fishname
df.sum$shuttlebox_start_side[i] <-startside
df.sum$presentation_when_fish_gave_up3[i] <-giveup3
df.sum$presentation_when_fish_gave_up4[i] <-giveup4
df.sum$shuttlebox_average_proportion_of_time_on_correct_side_during_gaps[i]<- mean_prop_time_correct_during_gap
df.sum$prop_within_10cm_during_stims_4_through_9[i]<-prop_within_10cm_during_stims_4_through_9
df.sum$prop_within_10cm_during_all_stims[i]<-prop_within_10cm_during_all_stims



#new dec 2019
df.sum$prop_within_10cm_during_gaps_282930[i] <- mean(df.prop.gap282930$proportion_time_within10cm_during_gap, na.rm = TRUE)
df.sum$prop_within_10cm_during_last_3_gaps_before_giveup4[i] <- mean(df.prop.last3gap$proportion_time_within10cm_during_gap, na.rm = TRUE)

df.sum$prop_within_10cm_during_gaps_282930_OFSCREENTIME[i] <- mean(df.prop.gap282930$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE)
df.sum$prop_within_10cm_during_last_3_gaps_before_giveup4_OFSCREENTIME[i] <- mean(df.prop.last3gap$proportion_time_within10cm_during_gap_OFSCREENTIME, na.rm = TRUE)

#df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]<- prop_p_value_kruskal
#df.sum$prop_shuttlebox_TTEST_p_value_first_and_last_3_gaps[i]<- prop_p_value_t
#df.sum$prop_shuttlebox_WILCOX_p_value_first_and_last_3_gaps[i]<- prop_p_value_wilcox 
#df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]<- prop_p_value_shapiro

#df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]<- dist_p_value_kruskal
#df.sum$dist_shuttlebox_TTEST_p_value_first_and_last_3_gaps[i]<- dist_p_value_t
#df.sum$dist_shuttlebox_WILCOX_p_value_first_and_last_3_gaps[i]<- dist_p_value_wilcox 
#df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]<- dist_p_value_shapiro
  
#if else statement for should I use t test or wilcox (depends on results of shapiro)  PROP

#  if(is.na(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i])== TRUE){
#    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- NA}
# else if(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- prop_p_value_t}
#  else if(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- prop_p_value_wilcox}


#if else statement for should I use t test or wilcox (depends on results of shapiro) DIST 
#  if(is.na(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i])== TRUE){
#    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- NA}
# else if(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- dist_p_value_t}
#  else if(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- dist_p_value_wilcox}

  
#add if else statement for is KRUSTAK(ANOVA) significant PROP
#if(df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$prop_was_kruskal_significant[i]<- 0}
#  else if(df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$prop_was_kruskal_significant[i]<-1}
#  else{
#    df.sum$prop_was_kruskal_significant[i]<- NA}
#1 means yes

#add if else statement for is T TEST/WILCOX significant PROP

#if(is.na(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i])== TRUE){
#    df.sum$prop_was_t_test_wilcox_significant[i]<- NA}
#else if(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]>0.05){
#    df.sum$prop_was_t_test_wilcox_significant[i]<- 0}
#  else if(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i] <=0.05){
#    df.sum$prop_was_t_test_wilcox_significant[i]<-1}


#add if else statement for is KRUSTAK(ANOVA) significant DIST
#if(df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$dist_was_kruskal_significant[i]<- 0}
#  else if(df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$dist_was_kruskal_significant[i]<-1}
#  else{
#    df.sum$dist_was_kruskal_significant[i]<- NA}
#1 means yes

#add if else statement for is T TEST/WILCOX significant DIST
#if(is.na(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i])== TRUE){
#    df.sum$dist_was_t_test_wilcox_significant[i]<- NA}
#else if(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]>0.05){
#    df.sum$dist_was_t_test_wilcox_significant[i]<- 0}
#  else if(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i] <=0.05){
#    df.sum$dist_was_t_test_wilcox_significant[i]<-1}


#df.sum$average_distance_during_the_first_3_gaps[i]<- avg_dist_during_first_3_gaps
  
#df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] <- comp_3v3_avg_dist #so a more positive number is better
#^^this is the continuous metric using the average distance! difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps
df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i] <- comp_3v3_avg_prop_correct #so a more negative number is better because it's the first 3 minus the last 3
#^^this is the continuous metric using the proportion time (also remember being in the "correct" area means it was in the third of the tank closest to the screen! difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps
df.sum$difference_avg_prop_correct_first_three_gaps_minus_gap_6[i] <- comp_123_v_6_avg_prop_correct
df.sum$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456[i] <- comp_123_v_456_avg_prop_correct

#this one line new as of december 2019
df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i]<-comp_3v3_avg_prop_within_10cmlast_30_secs
df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI_OFSCREENTIME[i] <-comp_3v3_avg_prop_within_10cmlast_30_secs_OFSCREENTIME


df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI_INVERTED[i]<-(comp_3v3_avg_prop_within_10cmlast_30_secs)*-1
df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI_OFSCREENTIME_INVERTED[i] <-(comp_3v3_avg_prop_within_10cmlast_30_secs_OFSCREENTIME) *-1


df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_282930_last_30_secs_of_ISI[i]<- comp_123_v_282930_within10cm_last_30_secs
df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_282930_last_30_secs_of_ISI_OFSCREENTIME[i]<- comp_123_v_282930_within10cm_last_30_secs_OFSCREENTIME
df.sum$difference_avg_prop_within10cm_123_minus_456_last_30_secs_of_ISI_OFSCREENTIME_INVERTED[i]<-(comp123_v_456_avg_prop_within10cm_OFSCREENTIME)*-1

df.sum$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met[i]<- prop_20percent_solvetrial

df.sum$did_fish_meet_60_percent_3_consecutive_criterion[i]<- did_fish_meet_60_percent_3_consecutive_criterion
df.sum$did_fish_meet_90_percent_2_consecutive_criterion[i]<- did_fish_meet_90_percent_2_consecutive_criterion
df.sum$speed_of_learning_60_percent_3_consecutive_criterion[i]<- speed_of_learning_60_percent_3_consecutive_criterion
df.sum$speed_of_learning_90_percent_2_consecutive_criterion[i]<-speed_of_learning_90_percent_2_consecutive_criterion
df.sum$did_fish_meet_within10cm_50_percent_3_consecutive_criterion[i] <-did_fish_meet_within10cm_50_percent_3_consecutive_criterion
df.sum$speed_of_learning_within10cm_50_percent_3_consecutive_criterion[i]<- speed_of_learning_within10cm_50_percent_3_consecutive_criterion
df.sum$average_proportion_within_10cm_gaps_456[i]<-average_proportion_within_10cm_gaps_456


df.sum$proportion_time_on_left_third_across_gaps_4_through_9[i]<-proportion_time_on_left_third_across_gaps_4_through_9
df.sum$proportion_time_on_right_third_across_gaps_4_through_9[i]<-proportion_time_on_right_third_across_gaps_4_through_9
df.sum$proportion_time_on_center_third_across_gaps_4_through_9[i]<-proportion_time_on_center_third_across_gaps_4_through_9

df.sum$proportion_time_on_left_10cm_across_gaps_4_through_9[i]<-proportion_time_on_left_10cm_across_gaps_4_through_9
df.sum$proportion_time_on_right_10cm_across_gaps_4_through_9[i]<-proportion_time_on_right_10cm_across_gaps_4_through_9
df.sum$proportion_time_on_center_10cm_across_gaps_4_through_9[i]<-proportion_time_on_center_10cm_across_gaps_4_through_9

df.sum$proportion_time_on_left_10cm_across_stims_1_through_6[i]<-proportion_time_on_left_10cm_across_stims_1_through_6
df.sum$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive[i] <- did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive
df.sum$did_fish_learn_OF_SCREEN_TIME_80_percent_within_10_cm_3_consecutive[i] <- did_fish_learn_OF_SCREEN_TIME_80_percent_within_10_cm_3_consecutive
df.sum$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_4_consecutive[i] <- did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_4_consecutive
#the last thing I want to do to assess performance categorically is highlight individuals who had a significant t test AND the performance INCREASED between the beginning and end (i.e. the average distance from correct shrank, and the proportion time on the correct side grew) 
#   if(is.na(df.sum$dist_was_t_test_wilcox_significant[i])== TRUE){
#    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- NA}
#   else if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i])== TRUE){
#    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- NA}
#   else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>0 & df.sum$dist_was_t_test_wilcox_significant[i]== 1){
#    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- 1}
#   else{
#    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- 0}

#  if(is.na(df.sum$prop_was_t_test_wilcox_significant[i])== TRUE){
#    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- NA}
#  else if(is.na(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i])== TRUE){
#    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- NA}
#  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]<0 & df.sum$prop_was_t_test_wilcox_significant[i]== 1){
#    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- 1}
#  else{
#    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- 0}


#did proportion time in the correct zone increase by 20% ? (THere's no relative here, only absolute)
  if(is.na(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]<= -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3[i]<- 1}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i] > -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3[i]<- 0}

if(is.na(df.sum$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456[i]<= -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456[i]<- 1}
  else if(df.sum$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456[i] > -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456[i]<- 0}


if(is.na(df.sum$difference_avg_prop_correct_first_three_gaps_minus_gap_6[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_three_gaps_minus_gap_6[i]<= -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6[i]<- 1}
  else if(df.sum$difference_avg_prop_correct_first_three_gaps_minus_gap_6[i] > -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6[i]<- 0}


#new_december_2019
if(is.na(df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_20_percent_first_3_vs_last_3_last_30sec[i]<- NA}
  else if(df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i]<= -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_20_percent_first_3_vs_last_3_last_30sec[i]<- 1}
  else if(df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i] > -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_20_percent_first_3_vs_last_3_last_30sec[i]<- 0}

if(is.na(df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_50_percent_first_3_vs_last_3_last_30sec[i]<- NA}
  else if(df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i]<= -0.5){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_50_percent_first_3_vs_last_3_last_30sec[i]<- 1}
  else if(df.sum$difference_avg_prop_with10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI[i] > -0.5){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_50_percent_first_3_vs_last_3_last_30sec[i]<- 0}


if(is.na(df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI_OFSCREENTIME[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_50_percent_first_3_vs_last_3_last_30sec_OFSCREENTIME[i]<- NA}
  else if(df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI_OFSCREENTIME[i]<= -0.5){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_50_percent_first_3_vs_last_3_last_30sec_OFSCREENTIME[i]<- 1}
  else if(df.sum$difference_avg_prop_within10cm_first_three_gaps_minus_last_three_gaps_before_giveup4_last_30_secs_of_ISI_OFSCREENTIME[i] > -0.5){
    df.sum$did_fish_solve_shuttlebox_using_prop_10cm_increase_of_at_least_50_percent_first_3_vs_last_3_last_30sec_OFSCREENTIME[i]<- 0}


df.sum$did_fish_participate_criterion1[i]<-1

if(df.sum$proportion_time_on_left_third_across_gaps_4_through_9[i] >= 0.9){
   df.sum$did_fish_participate_criterion1[i] <- 0} 

if(df.sum$proportion_time_on_right_third_across_gaps_4_through_9[i] >= 0.9){
   df.sum$did_fish_participate_criterion1[i] <- 0}

if(df.sum$proportion_time_on_center_third_across_gaps_4_through_9[i] >= 0.9){
   df.sum$did_fish_participate_criterion1[i] <- 0} 

df.sum$did_fish_participate_criterion2[i]<-1

if(df.sum$proportion_time_on_left_10cm_across_gaps_4_through_9[i] >= 0.9){
   df.sum$did_fish_participate_criterion2[i] <- 0} 

if(df.sum$proportion_time_on_right_10cm_across_gaps_4_through_9[i] >= 0.9){
   df.sum$did_fish_participate_criterion2[i] <- 0}

if(df.sum$proportion_time_on_center_10cm_across_gaps_4_through_9[i] >= 0.9){
   df.sum$did_fish_participate_criterion2[i] <- 0} 
 
df.sum$did_fish_participate_criterion3[i] <-did_fish_participate_criterion3
df.sum$did_fish_participate_criterion4[i] <-did_fish_participate_criterion4
df.sum$did_fish_participate_criterion5[i] <-did_fish_participate_criterion5
df.sum$did_fish_participate_criterion6[i] <-did_fish_participate_criterion6
df.sum$did_fish_participate_criterion7[i] <-did_fish_participate_criterion7

df.sum$number_of_gaps_in_which_the_fish_transited_during_the_gap[i] <- sum(df.transits$did_fish_transit_during_this_gap)
df.sum$number_of_gaps_in_which_the_fish_transited_between_two_sequential_gaps[i] <- sum(df.transits$did_fish_transit_by_next_gap)

#did distance from the screen decrease by ABSOLUTE 20% (i.e.256pixels)?
 # if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
 #   df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent_first_3_vs_last_3[i]<- NA}
 # else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>= 256){
 #  df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent_first_3_vs_last_3[i]<- 1}
 # else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] < 256){
 #   df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent_first_3_vs_last_3[i]<- 0}



#did distance form the screen decrease by RELATIVE 20% (i.e. the distance the fish started at (avg across the first 3 trials) x 0.2)
#  if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
#    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent_first_3_vs_last_3[i]<- NA}
#  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>= twenty_percent_of_first_3_avg_dist){
#    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent_first_3_vs_last_3[i]<- 1}
#  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] < twenty_percent_of_first_3_avg_dist){
#    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent_first_3_vs_last_3[i]<- 0}

}




df.sum.30sec<-df.sum
df.sum.30sec<- arrange(df.sum.30sec,speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met) %>% mutate(rank_speed_of_learning = 1:nrow(df.sum.30sec))


View(df.sum.30sec)
setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/")
write_csv(df.sum.30sec,'C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Comparative Cognition Shuttlebox Data december 2 2019 30 seconds.csv')

``` 


######################
######################
######################
######################
######################
######################
######################

#Now I'm going to do some analysi!

#using 30 second prop performance

#categorical- "learner" is if the fish increased the proportion time by 20%

```{r, echo=FALSE, message=FALSE, warning=FALSE}


df<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Comparative Cognition R Scripts/Numerosity Comparative Cognition Full Dataset July_20_2018.csv", col_names = TRUE, col_types = NULL)

#View(df)

det<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Detour/detour_data_for_R_April_5_2018.csv", col_names = TRUE, col_types = NULL)
#View(det)

df.full<- full_join(df,det, by = 'fish_name')
df.full
df.full<-df.full %>% mutate(detour_trial_1_solved_code = detour_trial_1_did_fish_solve_barrier_problem + detour_trial_1_did_fish_solve_full_social_problem )
df.full$detour_trial_1_did_fish_solve_barrier_problem <-as.character(df.full$detour_trial_1_did_fish_solve_barrier_problem)
df.full$detour_trial_1_did_fish_solve_full_social_problem <-as.character(df.full$detour_trial_1_did_fish_solve_full_social_problem)
df.full<-df.full %>% mutate(detour_trial_1_latency_to_enter_reward_following_barrier_solution = detour_trial_1_full_problem_time_to_social_reward_minus_time_to_contact_barrier- detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
df.full$number_of_medians_above_60_using_T30_to_T50_data<-as.numeric(df.full$number_of_medians_above_60_using_T30_to_T50_data)


df.full.30sec<-left_join(df.full,df.sum.30sec, by = 'fish_name')

########
df.full.30sec<-df.full.30sec %>% filter(did_fish_participate_criterion7 == 1)
df.full.30sec<-df.full.30sec %>% filter(is.na(did_fish_meet_within10cm_50_percent_3_consecutive_criterion) == FALSE)
########
df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
df.full.30sec$ did_fish_have_a_median_above_60<- as.character(df.full.30sec$ did_fish_have_a_median_above_60)

df.full.30sec<-mutate(df.full.30sec, shuttleDFAlast3 = paste(sex.y,did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, sep = '_'))
df.full.30sec<-mutate(df.full.30sec, shuttleDFA456 = paste(sex.y,did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456, sep = '_'))
df.full.30sec<-mutate(df.full.30sec, detDFA = paste(sex.y,detour_trial_1_did_fish_solve_barrier_problem, sep = '_'))
df.full.30sec<-mutate(df.full.30sec, numDFA = paste(sex.y,did_fish_have_a_median_above_60, sep = '_'))

df.full.30sec<-df.full.30sec %>%filter(is.na(presentation_when_fish_gave_up3)== FALSE)
df.full.30sec.num<-df.full.30sec %>%filter(is.na(did_fish_have_a_median_above_60)== FALSE)
df.full.30sec.det<-df.full.30sec %>%filter(is.na(detour_trial_1_did_fish_solve_barrier_problem)== FALSE)
#df.full.90sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.90sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
#df.full.90sec<-df.full.90sec %>%filter(is.na(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)== FALSE)

#df.full.10sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.10sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
#df.full.10sec<-df.full.10sec %>%filter(is.na(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)== FALSE)


#df.full.30sec$ did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent<-as.character(df.full.30sec$ did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent)
#df.full.30sec<-df.full.30sec %>%filter(is.na(did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent)== FALSE)
#df.full.30sec<-df.full.30sec %>%filter(is.na(detour_trial_1_date_of_trial)== FALSE)
#df.full.90sec$ did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent<-as.character(df.full.90sec$ did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent)
#df.full.90sec<-df.full.90sec %>%filter(is.na(did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent)== FALSE)

#df.full.10sec$ did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent<-as.character(df.full.10sec$ did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent)
#df.full.10sec<-df.full.10sec %>%filter(is.na(did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent)== FALSE)


###################IMPORTANT
#IMPORTANT! hard-code any fish whose sex.y isn't automatically listed here!
#RUN IT AGAIN!

#georgia/gustavo? and winthrop dont have detour data, so I have to hard code their sexes to be included
#df.full.30sec$sex.y[44]<- "M"
#df.full.30sec$sex.y[51]<- "M"

df.full.30sec.females<- df.full.30sec %>% filter(sex.y == "F") 
df.full.30sec.males<- df.full.30sec %>% filter(sex.y == "M") 

df.full.30sec.num.females<- df.full.30sec.num %>% filter(sex.y == "F") 
df.full.30sec.num.males<- df.full.30sec.num %>% filter(sex.y == "M") 

df.full.30sec.det.females<- df.full.30sec.det %>% filter(sex.y == "F") 
df.full.30sec.det.males<- df.full.30sec.det %>% filter(sex.y == "M") 

df.full.30sec.numsolvers<- df.full.30sec.num %>% filter(did_fish_have_a_median_above_60 == 1)
df.full.30sec.numnonsolvers<- df.full.30sec.num %>% filter(did_fish_have_a_median_above_60 == 0)


df.full.30sec.females.numsolvers<- df.full.30sec.num.females %>% filter(did_fish_have_a_median_above_60 == 1)
df.full.30sec.females.numnonsolvers<- df.full.30sec.num.females %>% filter(did_fish_have_a_median_above_60 == 0)

df.full.30sec.males.numsolvers<- df.full.30sec.num.males %>% filter(did_fish_have_a_median_above_60 == 1)
df.full.30sec.males.numnonsolvers<- df.full.30sec.num.males %>% filter(did_fish_have_a_median_above_60 == 0)


df.full.30sec.detsolvers<- df.full.30sec.det %>% filter(detour_trial_1_did_fish_solve_barrier_problem == 1)
df.full.30sec.detnonsolvers<- df.full.30sec.det %>% filter(detour_trial_1_did_fish_solve_barrier_problem == 0)


df.full.30sec.females.detsolvers<- df.full.30sec.det.females %>% filter(detour_trial_1_did_fish_solve_barrier_problem == 1)
df.full.30sec.females.detnonsolvers<- df.full.30sec.det.females %>% filter(detour_trial_1_did_fish_solve_barrier_problem == 0)

df.full.30sec.males.detsolvers<- df.full.30sec.det.males %>% filter(detour_trial_1_did_fish_solve_barrier_problem == 1)
df.full.30sec.males.detnonsolvers<- df.full.30sec.det.males %>% filter(detour_trial_1_did_fish_solve_barrier_problem == 0)





#write_csv(df.full.30sec,'C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Comparative Cognition Shuttlebox Data December 2 2019 30 seconds with detour and numerosity.csv')
```

#Some information on Fisher's Exact Test and the Freeman-Halton Test:

#R's Fisher Exact Test is the same as the Freeman-Halton Test (as long as you have a 2x2 table)
#Here's where you can confirm this: http://vassarstats.net/fisher3x3.html

#Chi-square and G-tests are known to be inefficient in assessing independence in an "m by n" table with cells having low expected frequency counts. The method generally recommended in this case is the Fisher's exact test.
#Freeman-Halton test extends the Fisher's exact test to the mxn setting. Fisher's exact test is the uniformly most powerful test in the 2x2 setting and does account for zero cells.
#https://stat.ethz.ch/R-manual/R-devel/library/stats/html/fisher.test.html
#https://www.researchgate.net/post/What_are_the_alternatives_to_the_Fishers_exact_test_when_assessing_independence_in_an_m_by_n_table_with_low_expected_frequencies_5
#https://www.researchgate.net/post/Which_method_is_appropriate_for_measuring_the_effect_size_after_applying_Fishers_Exact_Test
#http://www.biostathandbook.com/fishers.html








```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.character(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent 456
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.character(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent 6
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent
          predict average_performance_across_all_9_testing_trials
_using_T30_to_T50_data?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#FEMALES

shapiro.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num.females$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num.females$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot(color = 'red')+ stat_n_text() +
  ggtitle(' FEMALES 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent
          predict average_performance_across_all_9_testing_trials
_using_T30_to_T50_data?') +
  geom_text(x=1, y=0.3, label= glue::glue("p (t-test)= {round(p_value_t,4)}, 
                                         "), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
summary(mod)

number <- df.full.30sec %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
summary(mod)

number <- df.full.30sec %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(difference_avg_prop_correct_first_three_gaps_minus_gap_6, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_three_gaps_minusgap_6",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}

df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
shapiro.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.sum.30sec, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent_first_3_vs_last_3
          predict speed_of_learning_aka_which_presentation_
          20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=15, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.character(df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

shapiro.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.sum.30sec, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent_first_3_vs_456
          predict speed_of_learning_aka_which_presentation_
          20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=15, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec$sex.y)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec$sex.y)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=sex.y, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 sex predict speed_of_learning_aka_which_presentation_
          20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=15, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}


df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.character(df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)



shapiro.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.sum.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.sum.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.sum.30sec, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent_first_3_vs_6
          predict speed_of_learning_aka_which_presentation_
          20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=15, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#FEMALES
mod<- lm(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.num.females %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.females, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#MALES
mod<- lm(df.full.30sec.num.males$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.num.males %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.males, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.num$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps~ df.full.30sec.num$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps))
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps") +
  geom_smooth(method = "lm")

```



```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.num$ did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.num$ did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict difference_avg_prop_correct_
          first_3_gaps_minus_last_3_gaps?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
#MALES

shapiro.test(df.full.30sec.num.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.num.males$ did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.num.males$ did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.males, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' MALES 30 SECS Does did_fish_have_a_median_above_60
          predict difference_avg_prop_correct_
          first_3_gaps_minus_last_3_gaps?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
#females

shapiro.test(df.full.30sec.num.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.num.females$ did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.num.females$ did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' females 30 SECS Does did_fish_have_a_median_above_60
          predict difference_avg_prop_correct_
          first_3_gaps_minus_last_3_gaps?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec.det$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec.det$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, y=detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent
          predict detour_trial_1_barrier_problem_time_around_barrier_
minus_time_to_contact_barrier?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#females
shapiro.test(df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec.det.females$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec.det.females$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.females, aes(x=did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, y=detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' females 30 SECS Does did_fish_solve_shuttlebox_using_prop_correct_
increase_of_at_least_20_percent
          predict detour_trial_1_barrier_problem_time_around_barrier_
minus_time_to_contact_barrier?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
#FEMALES
mod<- lm(df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~ df.full.30sec.det.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.det.females %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.females, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier") +
  geom_smooth(method = "lm")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#MALES
mod<- lm(df.full.30sec.det.males$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~ df.full.30sec.det.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.det.males %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.males, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier") +
  geom_smooth(method = "lm")

```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~ df.full.30sec.det$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
summary(mod)

number <- df.full.30sec.det %>% filter(!is.na(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det, aes(difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps, detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier))
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps",y="detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier") +
  geom_smooth(method = "lm")

```






```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Doesdetour_trial_1_did_fish_solve_barrier_problem
          predict difference_avg_prop_correct_
          first_3_gaps_minus_last_3_gaps?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
#MALES

shapiro.test(df.full.30sec.det.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.males$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.males, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' MALES 30 SECS Doesdetour_trial_1_did_fish_solve_barrier_problem
          predict difference_avg_prop_correct_
          first_3_gaps_minus_last_3_gaps?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
#females

shapiro.test(df.full.30sec.det.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.females$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.females, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' females 30 SECS Doesdetour_trial_1_did_fish_solve_barrier_problem
          predict difference_avg_prop_correct_
          first_3_gaps_minus_last_3_gaps?') +
  geom_text(x=1, y=0.1, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```











```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$sex.y)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$sex.y)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=sex.y, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS does sex predict 
          presentation_when_fish_gave_up3?') +
  geom_text(x=1, y=10, label= glue::glue("p (wilcox)= {round(p_value_wilcox,3)}"), size = 6, color = "black")
p


```



#Here's some of the chi2 shuttlebox categorial by num/detour categorical data



#Chi2 of male to female shuttlebox solvers to nonsolvers:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

#to get the numbers I ran this code:
nrow(df.full.30sec.males%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.females%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.males%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))
nrow(df.full.30sec.females%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

solvers = c(12,2)
nonsolvers = c(13,16)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value
#female solvers = 12
#male solvers = 1
#female nonsolvers = 12
#male nonsolvers = 16



ggplot(df.full.30sec, aes(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (20% prop increase, using last 30 sec of gap) vs last 3",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=18, label= glue::glue("12"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue("16"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=12, label= glue::glue("13"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("2"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```



#chi2 of numerosity performance by shuttlebox performance

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

#to get the numbers I ran this code:
nrow(df.full.30sec.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

numsolvers = c(6,13)
numnonsolvers = c(3,8)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#numerosity solvers who solved shuttlebox = 6
#numerosity solvers who did not solve shuttlebox = 13

#numerosity nonsolvers who solved shuttlebox = 3
#numerosity nonsolvers who did not solve shuttlebox = 8

df.full.30sec.num$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec.num$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

df.full.30sec.num$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("8"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("3"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("13"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("6"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category 
                    first 3 to last 3",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

#to get the numbers I ran this code:
nrow(df.full.30sec.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

numsolvers = c(3,16)
numnonsolvers = c(2,9)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#numerosity solvers who solved shuttlebox = 3
#numerosity solvers who did not solve shuttlebox = 16

#numerosity nonsolvers who solved shuttlebox = 2
#numerosity nonsolvers who did not solve shuttlebox = 9

df.full.30sec.num$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.character(df.full.30sec.num$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

df.full.30sec.num$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("9"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("2"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("16"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("3"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category (456)",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

#to get the numbers I ran this code:
nrow(df.full.30sec.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

numsolvers = c(7,12)
numnonsolvers = c(3,8)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#numerosity solvers who solved shuttlebox = 7
#numerosity solvers who did not solve shuttlebox = 12

#numerosity nonsolvers who solved shuttlebox = 3
#numerosity nonsolvers who did not solve shuttlebox = 8

df.full.30sec.num$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.character(df.full.30sec.num$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

df.full.30sec.num$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("8"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("3"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("12"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("7"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category (6)",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

#to get the numbers I ran this code:
nrow(df.full.30sec.males.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.males.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

nrow(df.full.30sec.males.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.males.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

males.numsolvers = c(2,5)
males.numnonsolvers = c(1,4)
shuttleboxsolvenum<-data.frame(males.numsolvers,males.numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#numerosity solvers who solved shuttlebox = 2
#numerosity solvers who did not solve shuttlebox = 5

#numerosity nonsolvers who solved shuttlebox = 1
#numerosity nonsolvers who did not solve shuttlebox = 4

df.full.30sec.num.males$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.character(df.full.30sec.num.males$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

df.full.30sec.num.males$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.males$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num.males, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("4"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=0.2, label= glue::glue("1"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=5, label= glue::glue("5"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("2"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category (6)",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

#to get the numbers I ran this code:
nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

females.numsolvers = c(5,7)
females.numnonsolvers = c(2,4)
shuttleboxsolvenum<-data.frame(females.numsolvers,females.numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#numerosity solvers who solved shuttlebox = 5
#numerosity solvers who did not solve shuttlebox = 7

#numerosity nonsolvers who solved shuttlebox = 2
#numerosity nonsolvers who did not solve shuttlebox = 4

df.full.30sec.num.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.character(df.full.30sec.num.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.females$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num.females, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=15, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("4"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("2"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("7"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("5"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category (6)",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

#to get the numbers I ran this code:
nrow(df.full.30sec.males.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.males.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

nrow(df.full.30sec.males.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.males.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

solvers = c(0,7)
nonsolvers = c(0,5)
shuttleboxsolvenumfem<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvenumfem)
chip<-chi$p.value

```




#numerosity by shuttlebox performance just females

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

#to get the numbers I ran this code:
nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

solvers = c(6,6)
nonsolvers = c(3,3)
shuttleboxsolvenumfem<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvenumfem)
chip<-chi$p.value
#female numerosity solvers who solved shuttlebox = 6
#female numerosity solvers who did not solve shuttlebox = 6

#female numerosity nonsolvers who solved shuttlebox = 3
#female numerosity nonsolvers who did not solve shuttlebox = 3

df.full.30sec.num.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec.num.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)

df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.females$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num.females, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=8, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=12, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("3"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("3"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=7, label= glue::glue("6"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("6"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.3, y = 5, parse = TRUE, label= glue::glue("females"), size = 7, color = "black", hjust = 0)




```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

#to get the numbers I ran this code:
nrow(df.full.30sec.males.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.males.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

nrow(df.full.30sec.males.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.males.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

numsolvers = c(0,7)
numnonsolvers = c(2,3)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value


#numerosity solvers who solved shuttlebox = 0
#numerosity solvers who did not solve shuttlebox = 7

#numerosity nonsolvers who solved shuttlebox = 2
#numerosity nonsolvers who did not solve shuttlebox = 3

df.full.30sec.num.males$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.character(df.full.30sec.num.males$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

df.full.30sec.num.males$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.males$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num.males, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=15, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("3"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("2"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=6, label= glue::glue("7"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("0"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category (456)",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)




```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

#to get the numbers I ran this code:
nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

numsolvers = c(3,9)
numnonsolvers = c(0,6)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#numerosity solvers who solved shuttlebox = 3
#numerosity solvers who did not solve shuttlebox = 9

#numerosity nonsolvers who solved shuttlebox = 0
#numerosity nonsolvers who did not solve shuttlebox = 6

df.full.30sec.num.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.character(df.full.30sec.num.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.females$did_fish_have_a_median_above_60)


ggplot(df.full.30sec.num.females, aes(did_fish_have_a_median_above_60, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Numerosity Learning Category",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=13, label= glue::glue("numerosity 
                                                    Non-learners"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=15, label= glue::glue("numerosity 
                                                   Learners"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=4, label= glue::glue("6"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("0"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("9"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("3"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category (456)",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```



#numerosity by shuttlebox performance just males chi2 returns NA because there are no male solvers for num

#male numerosity solvers who solved shuttlebox = 0
#male numerosity solvers who did not solve shuttlebox = 7

#male numerosity nonsolvers who solved shuttlebox = 0
#male numerosity nonsolvers who did not solve shuttlebox = 5



#now for shuttlebox by detour both categorical

#chi2 of detour performance by shuttlebox performance

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
nrow(df.full.30sec.detsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.detsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

detsolvers = c(6,15)
detnonsolvers = c(7,14)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 6
#detour solvers who did not solve shuttlebox = 15

#detour nonsolvers who solved shuttlebox = 7
#detour nonsolvers who did not solve shuttlebox = 14

df.full.30sec.det$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec.det$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)



ggplot(df.full.30sec.det, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=22, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=9, label= glue::glue("14"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("7"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("15"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("6"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category to last 3",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```

#detour categorical with males only

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
nrow(df.full.30sec.males.detsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.males.detsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

nrow(df.full.30sec.males.detnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.males.detnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

detsolvers = c(1,8)
detnonsolvers = c(0,8)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value
#male detour solvers who solved shuttlebox = 6
#male detour solvers who did not solve shuttlebox = 14

#male detour nonsolvers who solved shuttlebox = 7
#male detour nonsolvers who did not solve shuttlebox = 14

df.full.30sec.det$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec.det$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)



ggplot(df.full.30sec.det.males, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=10, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=11, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=7, label= glue::glue("8"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("0"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=8, label= glue::glue("8"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("1"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.3, y = 5, parse = TRUE, label= glue::glue("males"), size = 7, color = "black", hjust = 0)



```


#detour categorical with females only

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det.females$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
nrow(df.full.30sec.females.detsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.females.detsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

nrow(df.full.30sec.females.detnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 1))
nrow(df.full.30sec.females.detnonsolvers%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3 == 0))

detsolvers = c(5,7)
detnonsolvers = c(7,6)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value
#female detour solvers who solved shuttlebox = 5
#female detour solvers who did not solve shuttlebox = 7

#female detour nonsolvers who solved shuttlebox = 7
#female detour nonsolvers who did not solve shuttlebox = 6

df.full.30sec.det.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3<-as.character(df.full.30sec.det.females$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3)



ggplot(df.full.30sec.det.females, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_last_3))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=14, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=12, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=8, label= glue::glue("6"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=1, label= glue::glue("7"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=7, label= glue::glue("7"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("5"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category to last 3",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.3, y = 5, parse = TRUE, label= glue::glue("females"), size = 7, color = "black", hjust = 0)



```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.num.males$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num.males %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.males, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num.females %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.females, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.4, y=3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

df.full.30sec.num$did_fish_have_a_median_above_60<-as.character(df.full.30sec.num$did_fish_have_a_median_above_60)
shapiro.test(df.full.30sec.num$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_have_a_median_above_60, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict speed_of_learning_aka_which_
          presentation_20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=15, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num.males$did_fish_have_a_median_above_60<-as.character(df.full.30sec.num.males$did_fish_have_a_median_above_60)

shapiro.test(df.full.30sec.num.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.males, aes(x=did_fish_have_a_median_above_60, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict speed_of_learning_aka_which_
          presentation_20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=8, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.character(df.full.30sec.num.females$did_fish_have_a_median_above_60)

shapiro.test(df.full.30sec.num.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_have_a_median_above_60, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict speed_of_learning_aka_which_
          presentation_20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=8, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```






```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=200, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "detour_trial_1_barrier_problem_time",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.det.males$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det.males %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.males, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=200, y=5,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "MALES detour_trial_1_barrier_problem_time",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det.females %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.females, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=100, y=3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES detour_trial_1_barrier_problem_time",y="speed_of_learning_aka_which_presentation_
       20_percent_prop_increase_was_met") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.character(df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)

shapiro.test(df.full.30sec.det$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict speed_of_learning_aka_which_
          presentation_20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=15, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.males, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict speed_of_learning_aka_which_
          presentation_20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=8, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem<-as.character(df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)

shapiro.test(df.full.30sec.det.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.females, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' female 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict speed_of_learning_aka_which_
          presentation_20_percent_prop_increase_was_met?') +
  geom_text(x=1, y=8, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


#stopped here for georgiafixed adjustment

```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~ df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="prop_correct_first_three_gaps_minus_avg_gaps_456") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~ df.full.30sec.num.males$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num.males %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.males, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="prop_correct_first_three_gaps_minus_avg_gaps_456") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~ df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num.females %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.females, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.4, y=0.5,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="prop_correct_first_three_gaps_minus_avg_gaps_456") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict prop_correct_first_three_gaps_minus_avg_gaps_456?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.males, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict prop_correct_first_three_gaps_minus_avg_gaps_456?') +
  geom_text(x=1, y=0.0, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict prop_correct_first_three_gaps_minus_avg_gaps_456?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```

##



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~ df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=200, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "detour_trial_1_barrier_problem_time",y="prop_correct_first_three_gaps_minus_avg_gaps_456") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~ df.full.30sec.det.males$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det.males %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.males, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=200, y=1,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "MALES detour_trial_1_barrier_problem_time",y="prop_correct_first_three_gaps_minus_avg_gaps_456") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~ df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det.females %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.females, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=150, y=0.6,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES detour_trial_1_barrier_problem_time",y="prop_correct_first_three_gaps_minus_avg_gaps_456") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict prop_correct_first_three_gaps_minus_avg_gaps_456?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.males, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict prop_correct_first_three_gaps_minus_avg_gaps_456?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.females, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_three_gaps_minus_avg_gaps_456)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' female 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict prop_correct_first_three_gaps_minus_avg_gaps_456?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_gap_6~ df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, difference_avg_prop_correct_first_three_gaps_minus_gap_6))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="prop_correct_first_three_gaps_minus_gap_6") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6~ df.full.30sec.num.males$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num.males %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.males, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, difference_avg_prop_correct_first_three_gaps_minus_gap_6))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.3, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="prop_correct_first_three_gaps_minus_gap_6") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6~ df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
summary(mod)

number <- df.full.30sec.num.females %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.females, aes(average_performance_across_all_9_testing_trials_using_T30_to_T50_data, difference_avg_prop_correct_first_three_gaps_minus_gap_6))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.4, y=0.5,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES average_performance_across_all_9_testing_
trials_using_T30_to_T50_data",y="prop_correct_first_three_gaps_minus_gap_6") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_three_gaps_minus_gap_6)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict prop_correct_first_three_gaps_minus_gap_6?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.males, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_three_gaps_minus_gap_6)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict prop_correct_first_three_gaps_minus_gap_6?') +
  geom_text(x=1, y=0.0, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_have_a_median_above_60, y=difference_avg_prop_correct_first_three_gaps_minus_gap_6)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_have_a_median_above_60
          predict prop_correct_first_three_gaps_minus_gap_6?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```

##



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_gap_6~ df.full.30sec.det$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, difference_avg_prop_correct_first_three_gaps_minus_gap_6))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=200, y=0.3,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "detour_trial_1_barrier_problem_time",y="prop_correct_first_three_gaps_minus_gap_6") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6~ df.full.30sec.det.males$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det.males %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.males, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, difference_avg_prop_correct_first_three_gaps_minus_gap_6))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=200, y=1,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "MALES detour_trial_1_barrier_problem_time",y="prop_correct_first_three_gaps_minus_gap_6") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6~ df.full.30sec.det.females$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
summary(mod)

number <- df.full.30sec.det.females %>% filter(!is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) %>% filter(!is.na(difference_avg_prop_correct_first_three_gaps_minus_gap_6)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.det.females, aes(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier, difference_avg_prop_correct_first_three_gaps_minus_gap_6))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=150, y=0.6,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES detour_trial_1_barrier_problem_time",y="prop_correct_first_three_gaps_minus_gap_6") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec$presentation_when_fish_gave_up3)
summary(mod)
#use the multiple r squRED IF DOING IT BY HAND

number <- df.full.30sec %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(presentation_when_fish_gave_up3, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=25,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="speed of learning") +
  geom_smooth(method = "lm")


```






```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.females$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.females$presentation_when_fish_gave_up3)
summary(mod)

number <- df.full.30sec.females %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.females, aes(presentation_when_fish_gave_up3, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = "red") + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=20,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "FEMALES how long fish participated (giveup3)",y="speed of learning") +
  geom_smooth(method = "lm")


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.males$speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met~ df.full.30sec.males$presentation_when_fish_gave_up3)
summary(mod)

number <- df.full.30sec.males %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.males, aes(presentation_when_fish_gave_up3, speed_of_learning_aka_which_presentation_20_percent_prop_increase_was_met))
p + geom_point(size = 3, color = "blue") + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=20,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "MALES how long fish participated (giveup3)",y="speed of learning") +
  geom_smooth(method = "lm")


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_three_gaps_minus_gap_6)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict prop_correct_first_three_gaps_minus_gap_6?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.males$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.males, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_three_gaps_minus_gap_6)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict prop_correct_first_three_gaps_minus_gap_6?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}


shapiro.test(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.det.females$difference_avg_prop_correct_first_three_gaps_minus_gap_6~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.det.females, aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=difference_avg_prop_correct_first_three_gaps_minus_gap_6)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' female 30 SECS Does detour_trial_1_did_fish_solve_barrier_problem
          predict prop_correct_first_three_gaps_minus_gap_6?') +
  geom_text(x=1, y=-0.4, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456)

#to get the numbers I ran this code:
nrow(df.full.30sec.males%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.females%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 1))
nrow(df.full.30sec.males%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))
nrow(df.full.30sec.females%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456 == 0))

solvers = c(4,3)
nonsolvers = c(21,15)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value
#female solvers = 4
#male solvers = 3
#female nonsolvers = 21
#male nonsolvers = 15



ggplot(df.full.30sec, aes(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_456, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (20% prop increase, using last 30 sec of gap, 456)",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=18, label= glue::glue("21"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue("15"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=5, label= glue::glue("4"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("3"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6<-as.numeric(df.full.30sec$ did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6)

#to get the numbers I ran this code:
nrow(df.full.30sec.males%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.females%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 1))
nrow(df.full.30sec.males%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))
nrow(df.full.30sec.females%>%filter(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6 == 0))

solvers = c(10,4)
nonsolvers = c(15,14)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value
#female solvers = 10
#male solvers = 4
#female nonsolvers = 15
#male nonsolvers = 14



ggplot(df.full.30sec, aes(did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent_first_3_vs_6, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (20% prop increase, using last 30 sec of gap, 6)",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=18, label= glue::glue("15"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue("14"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=5, label= glue::glue("10"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("4"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```

#Ok time for a DFA, or LDA

```{r, echo=FALSE, message=FALSE, warning=FALSE}

#an LDA (linear discriminant function) is like a PCA (principal component analysis) that is "supervised" i.e it uses class information. 
#Our classes are 1. female learners, 2. female nonlearners, 3. male learners, 4. male nonlearners

#THIS IS FOR NUMEROSITY

#https://www.statmethods.net/advstats/discriminant.html

#https://tgmstat.wordpress.com/2014/01/15/computing-and-visualizing-lda-in-r/




fit <- lda(numDFA, average_number_of_entries_full_4_minutes, average_reaction_time,unique_zones_entered_full_4_minutes, totalthigmo_full_4_minutes, average_prop_time_center_full_4_minutes, data = df.full.30sec)
fit





```



##THIS IS THE DATA ANALYSIS for the criteria that use the 60% prop correct for 3 consecutive ISI OR 90% prop correct for 2 ISI



```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion <-as.character(df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(did_fish_meet_60_percent_3_consecutive_criterion)), aes(x=did_fish_meet_60_percent_3_consecutive_criterion
, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_meet_60_percent_3_consecutive_criterion
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion <-as.character(df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(did_fish_meet_60_percent_3_consecutive_criterion)), aes(x=did_fish_meet_90_percent_2_consecutive_criterion
, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_meet_90_percent_2_consecutive_criterion
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion ~ df.full.30sec$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_90_percent_2_consecutive_criterion)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(presentation_when_fish_gave_up3, speed_of_learning_90_percent_2_consecutive_criterion
))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=10,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="speed of learning 90% 2 consecutive") +
  geom_smooth(method = "lm")


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_60_percent_3_consecutive_criterion ~ df.full.30sec$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_60_percent_3_consecutive_criterion)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(presentation_when_fish_gave_up3, speed_of_learning_60_percent_3_consecutive_criterion
))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=10,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="speed of learning 60% 3 consecutive") +
  geom_smooth(method = "lm")


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion~df.full.30sec$sex.y)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion~df.full.30sec$sex.y)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=sex.y, y=speed_of_learning_90_percent_2_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does sex predict 90% for two consecutive trials?') +
  geom_text(x=1, y=10, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion<-as.numeric(df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)

#to get the numbers I ran this code:
nrow(df.full.30sec.males%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 1))
nrow(df.full.30sec.females%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 1))
nrow(df.full.30sec.males%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 0))
nrow(df.full.30sec.females%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 0))

solvers = c(10,6)
nonsolvers = c(17,18)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value
#female solvers = 10
#male solvers = 6
#female nonsolvers = 17
#male nonsolvers = 18



ggplot(df.full.30sec, aes(did_fish_meet_90_percent_2_consecutive_criterion, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (did_fish_meet_90_percent_2_consecutive_criterion)",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=20, label= glue::glue("17"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue("18"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=7, label= glue::glue("10"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("6"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(speed_of_learning_90_percent_2_consecutive_criterion)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_90_percent_2_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 90% for two consecutive trials?') +
  geom_text(x=1, y=10, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$speed_of_learning_60_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_60_percent_3_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_60_percent_3_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(speed_of_learning_60_percent_3_consecutive_criterion)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_60_percent_3_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 60% for three consecutive trials?') +
  geom_text(x=1, y=10, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_60_percent_3_consecutive_criterion == 1))
nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_60_percent_3_consecutive_criterion == 0))

nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_60_percent_3_consecutive_criterion == 1))
nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_60_percent_3_consecutive_criterion == 0))

detsolvers = c(4,21) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(5,19)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 4
#detour solvers who did not solve shuttlebox = 21

#detour nonsolvers who solved shuttlebox = 5
#detour nonsolvers who did not solve shuttlebox = 19

df.full.30sec.det$did_fish_meet_60_percent_3_consecutive_criterion<-as.character(df.full.30sec.det$did_fish_meet_60_percent_3_consecutive_criterion)



ggplot(df.full.30sec.det, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_meet_60_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=9, label= glue::glue("19"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.08, y=1, label= glue::glue("5"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue("21"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("4"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    60% for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 1))
nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 0))

nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 1))
nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_90_percent_2_consecutive_criterion == 0))

detsolvers = c(5,20) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(11,13)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 5
#detour solvers who did not solve shuttlebox = 20

#detour nonsolvers who solved shuttlebox = 11
#detour nonsolvers who did not solve shuttlebox = 13

df.full.30sec.det$did_fish_meet_90_percent_2_consecutive_criterion<-as.character(df.full.30sec.det$did_fish_meet_90_percent_2_consecutive_criterion)



ggplot(df.full.30sec.det, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_meet_90_percent_2_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=14, label= glue::glue("13"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue("11"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue("20"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("5"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    90% for 2 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion<-as.character(df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec$did_fish_meet_60_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)), aes(x=did_fish_meet_60_percent_3_consecutive_criterion, y=detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS shuttlebox 60% for three consecutive trials
          predict detour latency to solve') +
  geom_text(x=1, y=10, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion<-as.character(df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)

test<-t.test(df.full.30sec$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier~df.full.30sec$did_fish_meet_90_percent_2_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)), aes(x=did_fish_meet_90_percent_2_consecutive_criterion, y=detour_trial_1_barrier_problem_time_around_barrier_minus_time_to_contact_barrier)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS shuttlebox 90% for two consecutive trials
          predict detour latency to solve') +
  geom_text(x=1, y=10, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_90_percent_2_consecutive_criterion ~ df.full.30sec$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_90_percent_2_consecutive_criterion)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(presentation_when_fish_gave_up3, speed_of_learning_90_percent_2_consecutive_criterion
))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=10,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="speed of learning 60% 3 consecutive") +
  geom_smooth(method = "lm")


```


###########STARTING HERE IS INFO ABOUT THE CRITERION OF THE 50% WITHIN 10CM FOR 3 CONSECUTIVE ISI

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

y<-nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
z<-nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

detsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value

fish<-fisher.test(shuttleboxsolvedet)
fishp<-fish$p.value


#detour solvers who solved shuttlebox = 
#detour solvers who did not solve shuttlebox = 

#detour nonsolvers who solved shuttlebox = 
#detour nonsolvers who did not solve shuttlebox = 

df.full.30sec.det$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.character(df.full.30sec.det$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)



ggplot(df.full.30sec.det, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_meet_within10cm_50_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=9, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 6, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 5.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det.females$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.females.detsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.females.detsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

y<-nrow(df.full.30sec.females.detnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
z<-nrow(df.full.30sec.females.detnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

detsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value

fish<-fisher.test(shuttleboxsolvedet)
fishp<-fish$p.value


#detour solvers who solved shuttlebox = 4
#detour solvers who did not solve shuttlebox = 21

#detour nonsolvers who solved shuttlebox = 5
#detour nonsolvers who did not solve shuttlebox = 19

df.full.30sec.det.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.character(df.full.30sec.det.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)



ggplot(df.full.30sec.det.females, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_meet_within10cm_50_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "FEMALES detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=7, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=6, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 6, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 5.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -3.3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```






```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 
          50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=10, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.females, !is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion, color = "red")) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 
          50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=6, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num$did_fish_have_a_median_above_60)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.numsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.numsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

y<-nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
z<-nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

numsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
numnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 
#detour solvers who did not solve shuttlebox = 

#detour nonsolvers who solved shuttlebox = 
#detour nonsolvers who did not solve shuttlebox = 

fish<-fisher.test(shuttleboxsolvenum)
fishp<-fish$p.value

df.full.30sec.num$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.character(df.full.30sec.num$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)



ggplot(df.full.30sec.num, aes(did_fish_have_a_median_above_60, fill =did_fish_meet_within10cm_50_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "numerosity solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=14, label= glue::glue("numerosity 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("numerosity 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=5, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)+
  annotate("text",x = -3.3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.females$did_fish_have_a_median_above_60)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

y<-nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
z<-nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

numsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
numnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 5
#detour solvers who did not solve shuttlebox = 16

#detour nonsolvers who solved shuttlebox = 2
#detour nonsolvers who did not solve shuttlebox = 11

fish<-fisher.test(shuttleboxsolvenum)
fishp<-fish$p.value

df.full.30sec.num.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.character(df.full.30sec.num.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)



ggplot(df.full.30sec.num.females, aes(did_fish_have_a_median_above_60, fill =did_fish_meet_within10cm_50_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "FEMALES numerosity solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-2, y=6, label= glue::glue("numerosity 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.4, y=12, label= glue::glue("numerosity 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=4, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=6, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)+
  annotate("text",x = -3.3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec.num$did_fish_have_a_median_above_60<-as.factor(df.full.30sec.num$did_fish_have_a_median_above_60)

test<-t.test(df.full.30sec.num$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.num$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.num, !is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)), aes(x=did_fish_have_a_median_above_60, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does numerosity solve categoy predict 
          50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=6, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.factor(df.full.30sec.num.females$did_fish_have_a_median_above_60)

test<-t.test(df.full.30sec.num.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.num.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.num.females, !is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)), aes(x=did_fish_have_a_median_above_60, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion, color = "red")) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' FEMALES 30 SECS Does numerosity solve categoy predict 
          50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=6, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec$sex.y)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec$sex.y)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=sex.y, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does sex predict 50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=10, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.numeric(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.males%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.females%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
y<-nrow(df.full.30sec.males%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))
z<-nrow(df.full.30sec.females%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

solvers = c(w,x)
nonsolvers = c(y,z)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value

#This is Fisher's exact Test, an alternative that can hendle small numbers in each cell (i.e. when we have only one male learner)
fish<-fisher.test(shuttleboxsolvesex)
fishp<-fish$p.value


#female solvers = w
#male solvers = x
#female nonsolvers = y
#male nonsolvers = z



ggplot(df.full.30sec, aes(did_fish_meet_within10cm_50_percent_3_consecutive_criterion, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (did_fish_meet_within10cm_50_percent_3_consecutive_criterion)",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=16, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=5, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 4, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 3.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -2, y = -1, parse = TRUE, label= glue::glue("Fisher_exact_test_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)

  
  



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion ~ df.full.30sec$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(presentation_when_fish_gave_up3, speed_of_learning_within10cm_50_percent_3_consecutive_criterion
))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=10,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="speed of learning 50% within 10cm 3 consecutive") +
  geom_smooth(method = "lm")


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion ~ df.full.30sec.females$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec.females %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.females, aes(presentation_when_fish_gave_up3, speed_of_learning_within10cm_50_percent_3_consecutive_criterion
))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=10,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="speed of learning 50% within 10cm 3 consecutive") +
  geom_smooth(method = "lm")


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion <-as.character(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up3~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(did_fish_meet_60_percent_3_consecutive_criterion)), aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion
, y=presentation_when_fish_gave_up3)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_meet_within10cm_50_percent_3_consecutive_criterion
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```




```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.females$presentation_when_fish_gave_up3)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion <-as.character(df.full.30sec.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec.females$presentation_when_fish_gave_up3~df.full.30sec.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.females$presentation_when_fish_gave_up3~df.full.30sec.females$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.females, !is.na(did_fish_meet_60_percent_3_consecutive_criterion)), aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion
, y=presentation_when_fish_gave_up3, color = "red")) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' FEMALES 30 SECS Does did_fish_meet_within10cm_50_percent_3_consecutive_criterion
          predict giveup3?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num$ did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test %>% broom::tidy() %>% dplyr::select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num$ did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does shuttlebox learning criterion at least 50% in 10cm 
          predict average_performance_across_all_9_testing_trials
_using_T30_to_T50_data?') +
  geom_text(x=1, y=0.3, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num.females$ did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test %>% broom::tidy() %>% dplyr::select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num.females$ did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' FEMALES 30 SECS Does shuttlebox learning criterion at least 50% in 10cm 
          predict average_performance_across_all_9_testing_trials
_using_T30_to_T50_data?') +
  geom_text(x=1, y=0.3, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```







```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(speed_of_learning_within10cm_50_percent_3_consecutive_criterion, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=8, y=0.2,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "speed_of_learning_within10cm_50_percent_3_consecutive_criterion",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num$average_proportion_within_10cm_gaps_456)
summary(mod)

number <- df.full.30sec.num %>% filter(!is.na(average_proportion_within_10cm_gaps_456)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num, aes(average_proportion_within_10cm_gaps_456, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.4, y=0.2,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_proportion_within_10cm_gaps_456",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num.females$average_proportion_within_10cm_gaps_456)
summary(mod)

number <- df.full.30sec.num.males %>% filter(!is.na(average_proportion_within_10cm_gaps_456)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.females, aes(average_proportion_within_10cm_gaps_456, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3, color = "red") + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.4, y=0.2,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_proportion_within_10cm_gaps_456",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod<- lm(df.full.30sec.num.males$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~ df.full.30sec.num.males$average_proportion_within_10cm_gaps_456)
summary(mod)

number <- df.full.30sec.num.males %>% filter(!is.na(average_proportion_within_10cm_gaps_456)) %>% filter(!is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.num.males, aes(average_proportion_within_10cm_gaps_456, average_performance_across_all_9_testing_trials_using_T30_to_T50_data))
p + geom_point(size = 3, color = "blue") + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=0.4, y=0.2,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "average_proportion_within_10cm_gaps_456",y="average_performance_across_all_9_testing_trials_using_
       T30_to_T50_data") +
  geom_smooth(method = "lm")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec$average_proportion_within_10cm_gaps_456 ~ df.full.30sec$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(average_proportion_within_10cm_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec, aes(presentation_when_fish_gave_up3, average_proportion_within_10cm_gaps_456
))
p + geom_point(size = 3, color = 'black') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=0.8,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="average_proportion_within_10cm_gaps_456") +
  geom_smooth(method = "lm")


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.males$average_proportion_within_10cm_gaps_456 ~ df.full.30sec.males$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec.males %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(average_proportion_within_10cm_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.males, aes(presentation_when_fish_gave_up3, average_proportion_within_10cm_gaps_456
))
p + geom_point(size = 3, color = 'blue') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=0.8,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="average_proportion_within_10cm_gaps_456") +
  geom_smooth(method = "lm")


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod<- lm(df.full.30sec.females$average_proportion_within_10cm_gaps_456 ~ df.full.30sec.females$presentation_when_fish_gave_up3)
modsum<-summary(mod)

number <- df.full.30sec.females %>% filter(!is.na(presentation_when_fish_gave_up3)) %>% filter(!is.na(average_proportion_within_10cm_gaps_456)) %>% nrow
p_value <- mod %>% broom::tidy() %>% filter(term != "(Intercept)") %>% dplyr::select(p.value) %>% unlist
r_squared <- mod %>% broom::glance() %>% dplyr::select(r.squared) %>% unlist

p <- ggplot(df.full.30sec.females, aes(presentation_when_fish_gave_up3, average_proportion_within_10cm_gaps_456
))
p + geom_point(size = 3, color = 'red') + 
  theme(text = element_text(size=10)) + 
  annotate("text", x=20, y=0.8,label= glue::glue("p = {round(p_value,4)}, R-squared:  {round(r_squared,3)}
        n = {number}"), size = 6, color = "black") + 
  labs(x= "how long fish participated (giveup3)",y="average_proportion_within_10cm_gaps_456") +
  geom_smooth(method = "lm")


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$average_proportion_within_10cm_gaps_456~df.full.30sec$sex.y)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$average_proportion_within_10cm_gaps_456~df.full.30sec$sex.y)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec, aes(x=sex.y, y=average_proportion_within_10cm_gaps_456)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does sex predict average_proportion_within_10cm_gaps_456?') +
  geom_text(x=1, y=0.8, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec.num$did_fish_have_a_median_above_60<-as.factor(df.full.30sec.num$did_fish_have_a_median_above_60)

test<-t.test(df.full.30sec.num$average_proportion_within_10cm_gaps_456~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.num$average_proportion_within_10cm_gaps_456~df.full.30sec.num$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.num, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=did_fish_have_a_median_above_60, y=average_proportion_within_10cm_gaps_456)) +
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does numerosity solve categoy predict 
          proportion correct over 456 in shuttlebox?') +
  geom_text(x=1, y=0.6, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num.males$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec.num.males$did_fish_have_a_median_above_60<-as.factor(df.full.30sec.num.males$did_fish_have_a_median_above_60)

test<-t.test(df.full.30sec.num.males$average_proportion_within_10cm_gaps_456~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.num.males$average_proportion_within_10cm_gaps_456~df.full.30sec.num.males$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.num.males, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=did_fish_have_a_median_above_60, y=average_proportion_within_10cm_gaps_456)) +
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' males 30 SECS Does numerosity solve categoy predict 
          proportion correct over 456 in shuttlebox?') +
  geom_text(x=1, y=0.6, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num.females$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.factor(df.full.30sec.num.females$did_fish_have_a_median_above_60)

test<-t.test(df.full.30sec.num.females$average_proportion_within_10cm_gaps_456~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.num.females$average_proportion_within_10cm_gaps_456~df.full.30sec.num.females$did_fish_have_a_median_above_60)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.num.females, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=did_fish_have_a_median_above_60, y=average_proportion_within_10cm_gaps_456, color = "red")) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' FEMALES 30 SECS Does numerosity solve categoy predict 
          proportion correct over 456 in shuttlebox?') +
  geom_text(x=1, y=0.8, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.det$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det$average_proportion_within_10cm_gaps_456~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.det$average_proportion_within_10cm_gaps_456~df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.det, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=average_proportion_within_10cm_gaps_456)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 
          shuttlebox performance at 456?') +
  geom_text(x=1, y=0.8, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.det.males$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.males$average_proportion_within_10cm_gaps_456~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.det.males$average_proportion_within_10cm_gaps_456~df.full.30sec.det.males$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.det.males, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=average_proportion_within_10cm_gaps_456)) + 
  geom_boxplot(color = "blue")+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 
          shuttlebox performance at 456?') +
  geom_text(x=1, y=0.8, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.det.females$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.det.females$average_proportion_within_10cm_gaps_456~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.det.females$average_proportion_within_10cm_gaps_456~df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.det.females, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=average_proportion_within_10cm_gaps_456)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' females 30 SECS Does detour solve categoy predict 
          shuttlebox performance at 456?') +
  geom_text(x=1, y=0.8, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$average_proportion_within_10cm_gaps_456)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.factor(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$average_proportion_within_10cm_gaps_456~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$average_proportion_within_10cm_gaps_456~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(average_proportion_within_10cm_gaps_456)), aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion, y=average_proportion_within_10cm_gaps_456)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does shuttlebox solve category predict
          shuttlebox performance at 456?') +
  geom_text(x=1, y=0.8, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p

```



############################################
Here's where I'm going to look at the same stuff as before (50% within 10cm criterion), but with just "participants"


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.detsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

y<-nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
z<-nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

detsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value

fish<-fisher.test(shuttleboxsolvedet)
fishp<-fish$p.value


#detour solvers who solved shuttlebox = 3
#detour solvers who did not solve shuttlebox = 10

#detour nonsolvers who solved shuttlebox = 1
#detour nonsolvers who did not solve shuttlebox = 9

df.full.30sec.det$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.character(df.full.30sec.det$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)



ggplot(df.full.30sec.det, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_meet_within10cm_50_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=8, label= glue::glue("{as.character(z)}"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue("{as.character(y)}"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue("{as.character(x)}"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("{as.character(w)}"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 6, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 5.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.numeric(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.males%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.females%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
y<-nrow(df.full.30sec.males%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))
z<-nrow(df.full.30sec.females%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

solvers = c(x,w)
nonsolvers = c(z,y)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value

#This is Fisher's exact Test, an alternative that can hendle small numbers in each cell (i.e. when we have only one male learner)
fish<-fisher.test(shuttleboxsolvesex)
fishp<-fish$p.value


#female solvers = X
#male solvers = X
#female nonsolvers = X
#male nonsolvers = X



ggplot(df.full.30sec, aes(did_fish_meet_within10cm_50_percent_3_consecutive_criterion, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (did_fish_meet_within10cm_50_percent_3_consecutive_criterion)",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=18, label= glue::glue("{as.character(z)}"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue("{as.character(y)}"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=4, label= glue::glue("{as.character(x)}"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("{as.character(w)}"), size = 7, color = "white", hjust = 0) +
  
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 4, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 3.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -2, y = -1, parse = TRUE, label= glue::glue("Fisher_exact_test_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num$did_fish_have_a_median_above_60)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.numsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
x<-nrow(df.full.30sec.numsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

y<-nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 1))
z<-nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_meet_within10cm_50_percent_3_consecutive_criterion == 0))

numsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
numnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value

fish<-fisher.test(shuttleboxsolvenum)
fishp<-fish$p.value


#num solvers who solved shuttlebox = 2
#num solvers who did not solve shuttlebox = 6

#num nonsolvers who solved shuttlebox = 0
#num nonsolvers who did not solve shuttlebox = 6

df.full.30sec.num$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.character(df.full.30sec.num$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)



ggplot(df.full.30sec.num, aes(did_fish_have_a_median_above_60, fill =did_fish_meet_within10cm_50_percent_3_consecutive_criterion))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "numerosity solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("num 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("num 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=8, label= glue::glue("{as.character(z)}"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue("{as.character(y)}"), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue("{as.character(x)}"), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue("{as.character(w)}"), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 6, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 5.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.factor(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(average_performance_across_all_9_testing_trials_using_T30_to_T50_data)), aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does shuttlebox solve category predict
          numerosity performance?') +
  geom_text(x=1, y=0.2, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$prop_within_10cm_during_stims_4_through_9)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_participate_criterion4<-as.factor(df.full.30sec$did_fish_participate_criterion4)

test<-t.test(df.full.30sec$prop_within_10cm_during_stims_4_through_9~df.full.30sec$did_fish_participate_criterion4)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$prop_within_10cm_during_stims_4_through_9~df.full.30sec$did_fish_participate_criterion4)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(prop_within_10cm_during_stims_4_through_9)), aes(x=did_fish_participate_criterion4, y=prop_within_10cm_during_stims_4_through_9)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does prop time in front of screen (during stim)
          predict participation (criterion 4)?') +
  geom_text(x=1, y=0.2, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$prop_within_10cm_during_stims_4_through_9)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.factor(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$prop_within_10cm_during_stims_4_through_9~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$prop_within_10cm_during_stims_4_through_9~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(prop_within_10cm_during_stims_4_through_9)), aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion, y=prop_within_10cm_during_stims_4_through_9)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does prop time in front of screen (during stim)
          predict learning?') +
  geom_text(x=1, y=0.2, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p

```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$prop_within_10cm_during_all_stims)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_participate_criterion4<-as.factor(df.full.30sec$did_fish_participate_criterion4)

test<-t.test(df.full.30sec$prop_within_10cm_during_all_stims~df.full.30sec$did_fish_participate_criterion4)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$prop_within_10cm_during_all_stims~df.full.30sec$did_fish_participate_criterion4)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(prop_within_10cm_during_all_stims)), aes(x=did_fish_participate_criterion4, y=prop_within_10cm_during_all_stims)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does prop time in front of screen (during stim)
          predict participation (criterion 4)?') +
  geom_text(x=1, y=0.2, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$prop_within_10cm_during_all_stims)
#if shapiro wilk is NOT significant, use a t test

df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion<-as.factor(df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)

test<-t.test(df.full.30sec$prop_within_10cm_during_all_stims~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$prop_within_10cm_during_all_stims~df.full.30sec$did_fish_meet_within10cm_50_percent_3_consecutive_criterion)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(prop_within_10cm_during_all_stims)), aes(x=did_fish_meet_within10cm_50_percent_3_consecutive_criterion, y=prop_within_10cm_during_all_stims)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle('30 SECS Does prop time in front of screen (during all stim)
          predict participation (criterion 4)?') +
  geom_text(x=1, y=0.2, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p

```












###########STARTING HERE IS INFO ABOUT THE CRITERION OF THE 50% WITHIN 10CM FOR 3 CONSECUTIVE ISI- BUT NOW ONLY OF TIME AT SCREENS

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.detsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
x<-nrow(df.full.30sec.detsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

y<-nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
z<-nrow(df.full.30sec.detnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

detsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value

fish<-fisher.test(shuttleboxsolvedet)
fishp<-fish$p.value


#detour solvers who solved shuttlebox = 
#detour solvers who did not solve shuttlebox = 

#detour nonsolvers who solved shuttlebox = 
#detour nonsolvers who did not solve shuttlebox = 

df.full.30sec.det$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive<-as.character(df.full.30sec.det$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)



ggplot(df.full.30sec.det, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=9, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category OF SCREEN TIME
  50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 6, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 5.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.det.females$detour_trial_1_did_fish_solve_barrier_problem<-as.numeric(df.full.30sec.det.females$ detour_trial_1_did_fish_solve_barrier_problem)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.females.detsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
x<-nrow(df.full.30sec.females.detsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

y<-nrow(df.full.30sec.females.detnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
z<-nrow(df.full.30sec.females.detnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

detsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
detnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvedet<-data.frame(detsolvers,detnonsolvers)
chi<-chisq.test(shuttleboxsolvedet)
chip<-chi$p.value

fish<-fisher.test(shuttleboxsolvedet)
fishp<-fish$p.value


#detour solvers who solved shuttlebox = 4
#detour solvers who did not solve shuttlebox = 21

#detour nonsolvers who solved shuttlebox = 5
#detour nonsolvers who did not solve shuttlebox = 19

df.full.30sec.det.females$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive<-as.character(df.full.30sec.det.females$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)



ggplot(df.full.30sec.det.females, aes(detour_trial_1_did_fish_solve_barrier_problem, fill =did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "FEMALES detour solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=24, label= glue::glue("detour 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("detour 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=7, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=6, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category OF SCREEN TIME
  50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 6, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 5.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -3.3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```






```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 
          50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=4, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec.females$speed_of_learning_within10cm_50_percent_3_consecutive_criterion~df.full.30sec.females$detour_trial_1_did_fish_solve_barrier_problem)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec.females, !is.na(speed_of_learning_within10cm_50_percent_3_consecutive_criterion)), aes(x=detour_trial_1_did_fish_solve_barrier_problem, y=speed_of_learning_within10cm_50_percent_3_consecutive_criterion, color = "red")) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does detour solve categoy predict 
          50% within 10cm for three consecutive trials?') +
  geom_text(x=1, y=6, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```





```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num$did_fish_have_a_median_above_60)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.numsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
x<-nrow(df.full.30sec.numsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

y<-nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
z<-nrow(df.full.30sec.numnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

numsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
numnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 
#detour solvers who did not solve shuttlebox = 

#detour nonsolvers who solved shuttlebox = 
#detour nonsolvers who did not solve shuttlebox = 

fish<-fisher.test(shuttleboxsolvenum)
fishp<-fish$p.value

df.full.30sec.num$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive<-as.character(df.full.30sec.num$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)



ggplot(df.full.30sec.num, aes(did_fish_have_a_median_above_60, fill =did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "numerosity solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=14, label= glue::glue("numerosity 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=20, label= glue::glue("numerosity 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=5, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=8, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)+
  annotate("text",x = -3.3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec.num.females$did_fish_have_a_median_above_60<-as.numeric(df.full.30sec.num.females$did_fish_have_a_median_above_60)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
x<-nrow(df.full.30sec.females.numsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

y<-nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
z<-nrow(df.full.30sec.females.numnonsolvers%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

numsolvers = c(w,x) #Top to bottom down below, it's (4th,3rd)
numnonsolvers = c(y,z)                             # (2nd,1st)
shuttleboxsolvenum<-data.frame(numsolvers,numnonsolvers)
chi<-chisq.test(shuttleboxsolvenum)
chip<-chi$p.value
#detour solvers who solved shuttlebox = 5
#detour solvers who did not solve shuttlebox = 16

#detour nonsolvers who solved shuttlebox = 2
#detour nonsolvers who did not solve shuttlebox = 11

fish<-fisher.test(shuttleboxsolvenum)
fishp<-fish$p.value

df.full.30sec.num.females$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive<-as.character(df.full.30sec.num.females$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)



ggplot(df.full.30sec.num.females, aes(did_fish_have_a_median_above_60, fill =did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "FEMALES numerosity solving Category",y="number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-2, y=6, label= glue::glue("numerosity 
                                                    non-solvers"), size = 5, color = "black", hjust = 0) +
  annotate("text", x=0.4, y=12, label= glue::glue("numerosity 
                                                   solvers"), size = 5, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.21, y=4, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.1, y=1, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.7, y=6, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  scale_color_manual(values=c("green", "red")) +
  theme(legend.position="left") + 
  scale_fill_manual(values=c("coral2", "forestgreen"),name="shuttlebox learning category
                    50% within 10cm for 3 consecutive",labels=c("shuttlebox nonlearners", "shuttlebox learners")) + 
  annotate("text",x = -2.3, y = 3, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -1.4, y = 2.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0)+
  annotate("text",x = -3.3, y = 4, parse = TRUE, label= glue::glue("Fisher_exact_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)



```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df.full.30sec$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive<-as.numeric(df.full.30sec$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)

#to get the numbers I ran this code:
w<-nrow(df.full.30sec.males%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
x<-nrow(df.full.30sec.females%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 1))
y<-nrow(df.full.30sec.males%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))
z<-nrow(df.full.30sec.females%>%filter(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive == 0))

solvers = c(w,x)
nonsolvers = c(y,z)
shuttleboxsolvesex<-data.frame(solvers,nonsolvers)
chi<-chisq.test(shuttleboxsolvesex)
chip<-chi$p.value

#This is Fisher's exact Test, an alternative that can hendle small numbers in each cell (i.e. when we have only one male learner)
fish<-fisher.test(shuttleboxsolvesex)
fishp<-fish$p.value


#female solvers = w
#male solvers = x
#female nonsolvers = y
#male nonsolvers = z



ggplot(df.full.30sec, aes(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive, fill = sex.y))+
  geom_histogram(binwidth = 0.5) + 
  labs(x= "Shuttlebox Learning Category (did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)",y="Number of individuals") +  
  scale_x_discrete(breaks=c(0, 1)) +
  annotate("text", x=-0.48, y=32, label= glue::glue("Non-learners"), size = 7, color = "black", hjust = 0) +
  annotate("text", x=0.66, y=17, label= glue::glue("Learners"), size = 7, color = "black", hjust = 0) +
  theme(plot.title = element_text(hjust = 0)) +
  annotate("text", x=-0.12, y=16, label= glue::glue(z), size = 7, color = "white", hjust = 0)+
  annotate("text", x=-0.12, y=2, label= glue::glue(y), size = 7, color = "white", hjust = 0) +
  annotate("text", x=0.88, y=5, label= glue::glue(x), size = 7, color = "white", hjust = 0)+
  annotate("text", x=0.88, y=1, label= glue::glue(w), size = 7, color = "white", hjust = 0) +
  
  scale_color_manual(values=c("deepskyblue4", "darkorange2")) +
  theme(legend.position="left") + 
  #guides(fill=guide_legend(title= "Sex")) +
  scale_fill_manual(values=c("deepskyblue4", "darkorange2"),name="Sex",labels=c("  Female", "  Male")) + 
  annotate("text",x = -1, y = 4, parse = TRUE, label= glue::glue("{as.character(chisquaredtxt)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -0.7, y = 3.86, parse = TRUE, label= glue::glue("{round(chip,3)}"), size = 7, color = "black", hjust = 0) +
  annotate("text",x = -2, y = -1, parse = TRUE, label= glue::glue("Fisher_exact_test_p_{round(fishp,3)}"), size = 7, color = "black", hjust = 0)


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)
p_value_t<- test %>% broom::tidy() %>% dplyr::select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num$ did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num, aes(x=did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does shuttlebox learning criterion at least 50% in 10cm 
  OF SCREEN TIME predict average_performance_across_all_9_testing_trials
_using_T30_to_T50_data?') +
  geom_text(x=1, y=0.3, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data)
#if shapiro wilk is NOT significant, use a t test

test<-t.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num.females$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)
p_value_t<- test %>% broom::tidy() %>% dplyr::select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.full.30sec.num.females$average_performance_across_all_9_testing_trials_using_T30_to_T50_data~df.full.30sec.num.females$ did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(df.full.30sec.num.females, aes(x=did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive, y=average_performance_across_all_9_testing_trials_using_T30_to_T50_data)) + 
  geom_boxplot(color = "red")+ stat_n_text() +
  ggtitle(' 30 SECS Does shuttlebox learning criterion at least 50% in 10cm 
  OF SCREEN TIME predict average_performance_across_all_9_testing_trials
_using_T30_to_T50_data?') +
  geom_text(x=1, y=0.3, label= glue::glue("p (t-test)= {round(p_value_t,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up4)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$sex.y <-as.character(df.full.30sec$sex.y)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up4~df.full.30sec$sex.y)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up4~df.full.30sec$sex.y)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(sex.y)), aes(x=sex.y
, y=presentation_when_fish_gave_up4)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does sex.y
          predict giveup4?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
shapiro.test(df.full.30sec$presentation_when_fish_gave_up4)
#if shapiro wilk is NOT significant, use a t test
df.full.30sec$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive <-as.character(df.full.30sec$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)

test<-t.test(df.full.30sec$presentation_when_fish_gave_up4~df.full.30sec$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)
p_value_t<- test$p.value
wilcox_test<-wilcox.test(df.full.30sec$presentation_when_fish_gave_up4~df.full.30sec$did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)
p_value_wilcox<-wilcox_test$p.value

p <- ggplot(data=subset(df.full.30sec, !is.na(did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive)), aes(x=did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive
, y=presentation_when_fish_gave_up4)) + 
  geom_boxplot()+ stat_n_text() +
  ggtitle(' 30 SECS Does did_fish_learn_OF_SCREEN_TIME_50_percent_within_10_cm_3_consecutive
          predict giveup4?') +
  geom_text(x=1, y=20, label= glue::glue("p (wilcox)= {round(p_value_wilcox,4)}"), size = 6, color = "black")
p


```









###########
###########

#EXTRA STUFF HERE
```{r, echo=FALSE, message=FALSE, warning=FALSE}

#EXAMPLE ANOVA- in my case the categorical metric would be the presentation # (probably need to make it as.character) and the continuous measure would be distance or proportion for that presentation

fit <- aov(continuous_metric ~ categorical_metric, data=df) 
p_value_ANOVA<- summary(fit)[[1]][["Pr(>F)"]][[1]]
df$categorical_metric<-as.factor(df$categorical_metric)

kruskalfit<-kruskal.test(continuous_metric ~ categorical_metric, data=df)
p_value_kruskal<- kruskalfit$p.value

#Does categorical_metric predict average performance over the full 4 minutes?
p <- ggplot(df, aes(x=categorical_metric, y=continuous_metric)) + 
  geom_boxplot()+ stat_n_text() 
p +  ggtitle ("Does categorical_metric predict continuous_metric?")+
  geom_text(x=3, y=0.2, label= glue::glue("p (ANOVA) = {round(p_value_ANOVA,4)},
                                          p(Kruskal) = {round(p_value_kruskal,4)}"), size = 6, color = "black")

```



#This section is a visualization of an individual fish's trial, which I what I looked at to determine the giveup presentation
```{r, echo=FALSE, message=FALSE, warning=FALSE}

#All the stuff after this was me playing around with one score sheet to try and visualize what is going on in the trial, we should not run these parts. 
library(ggplot2)
library(dplyr)
library(rmarkdown)
library(knitr)
library(readr)
library(utils)
library(EnvStats)
library(hqmisc)

file_list<- list.files("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")
shuttleleft<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_L_framesofinterest.csv", col_names = TRUE, col_types = NULL)
shuttleright<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_R_framesofinterest.csv", col_names = TRUE, col_types = NULL)

i<-51

##
 setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")
  df<- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  fishname <- strsplit(file_list[i],'_')[[1]][4]
  startside <- strsplit(file_list[i],'_')[[1]][5]
  
  if(startside == "L"){
    df.full<- full_join(df,shuttleleft, by = 'frame_number')}
  if(startside == "R"){
    df.full<- full_join(df,shuttleright, by = 'frame_number')}
  df.full<-df.full %>% mutate(distance_from_correct = abs(correct_x_pixel - x))
  df.full.stim<-df.full %>% filter(type == 'stim')
#  df.full.gap<-df.full %>% filter(type == 'gap')

#  test_column_prop_gap <- vector(length = length(unique(df.full.gap$presentation)))
#  df.prop.gap<-data.frame(presentation = test_column_prop_gap)
  
#   for(j in 1:length(unique(df.full.gap$presentation))){
#    jnum<-as.numeric(j)
#    df.prop.gap$presentation[j] <-jnum
#    nrow<-df.full.gap %>% filter(presentation == jnum) %>% nrow()
#    correct_nrow<-df.full.gap %>% filter(presentation == jnum) %>% filter(distance_from_correct < 640) %>% nrow()
#    df.prop.gap$proportion_time_correct_during_gap[j]<-correct_nrow/nrow
#  }
  
   test_column_prop_stim <- vector(length = length(unique(df.full.stim$presentation)))
  df.prop.stim<-data.frame(presentation = test_column_prop_stim)
  
  for(j in 1:length(unique(df.full.stim$presentation))){
    jnum<-as.numeric(j)
    df.prop.stim$presentation[j] <-jnum
    nrow<-df.full.stim %>% filter(presentation == jnum) %>% nrow()
    correct_nrow<-df.full.stim %>% filter(presentation == jnum) %>% filter(distance_from_correct < 246) %>% nrow() #246 is 10cm, 427 is 1.3 of the tank
    df.prop.stim$proportion_time_correct_during_stim[j]<-correct_nrow/nrow
  }

#This is taking an average distance_from_correct for each gap/presentation
#df.gap.sum<-group_by(df.full.gap, presentation)%>% summarize(avg_dist_from_correct_by_pres = #mean(distance_from_correct, na.rm = TRUE))
#graph distance from screen during habituation and during stim  (sum across all presentations)

p <- ggplot(df.prop.stim, aes(presentation, proportion_time_correct_during_stim)) #NOTE I CHANGED THIS FROM GAP TO STIM 
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  #geom_smooth(method = "lm") +
  geom_vline(xintercept =5)+
  geom_vline(xintercept =10)+
  geom_vline(xintercept =15)+
  geom_vline(xintercept =20)+
  geom_vline(xintercept =25)+
  geom_vline(xintercept =30)+
  ggtitle(fishname)



'''
p <- ggplot(df.gap.sum, aes(presentation, avg_dist_from_correct_by_pres))
p + geom_point(size = 3) + 
  theme(text = element_text(size=10)) + 
  geom_smooth(method = "lm") +
  geom_vline(xintercept =5)+
  geom_vline(xintercept =10)+
  geom_vline(xintercept =15)+
  geom_vline(xintercept =20)+
  geom_vline(xintercept =25)+
  geom_vline(xintercept =30)+
  ggtitle(fishname)
'''

```













#I'M MOVING THE SCRIPT TO LOOK ACROSS THE FULL GAP (THEN THE LAST 10 SECONDS) DOWN HERE, BECAUSE WE'RE GOING WITH THE LAST 30 SECONDS















```{r, echo=FALSE, message=FALSE}
#Note- Garret, Gabriel, and Griffin shuttlebox videos too hard to score, no data

setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets/")

file_list<- list.files("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")


shuttleleft<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_L_framesofinterest.csv", col_names = TRUE, col_types = NULL)
#View(shuttleleft)

shuttleright<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_R_framesofinterest.csv", col_names = TRUE, col_types = NULL)
#View(shuttleright)

giveupdoc<-read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/shuttlebox_giveup_2_and_3.csv", col_names = TRUE, col_types = NULL)

test_column <- vector(length = length(file_list))
df.sum <- data.frame(fish_name = test_column)

rsquaredtxt <- (expression(r^2))
chisquaredtxt <- (expression(X^2))
```



```{r, echo=FALSE, message=FALSE}

for(i in 1:length(file_list)){
  setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")
  
  df<- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  
  fishname <- strsplit(file_list[i],'_')[[1]][4]
  startside <- strsplit(file_list[i],'_')[[1]][5]
  giveup3<-giveupdoc$giveup3[i]
 #giveup 2 is the more restricted version of giveup- this is the last tgap before 3 sequential gaps where the fish did not move. This was judged by the proportion of time on the correct side, if it went 0-100-0 or 100-0-100.
  
  #here's where I'm going to add the giveup3- which is giveup 2 but we only start looking starting on the 4th presentation and we look DURING STIMS not GAPS. The idea is that it might take a while for a fish to not be scared so we're giving them the first 3 trials (i.e. 5 minutes) to get used to it. the first trial that can count towards the giveup is trial 4
  
  #e.g. if 0-100-0 is presentations (stim) 17,18,19, then giveup presentation is 16
  
  #NOTE ABOUT GIVEUP 3- when we use giveup 3 and the 3v3, there are X fish who cannot participate because they don't have 6 ISI's in which to score the first 3 vs the last 3 (i.e. they give up before trial 6)
  
  
  #Now given giveup3, where the fish stops being counted if it doesn't participate for three tirals in a row but only after the first 4, it's easy to say what the last three trials before the giveup are, but what are the first 3? Are they trials 1,2,3 or are they trials 4,5,6? I'm going to use 1,2,3 for now, but understand that I could use 4,5,6. I don't have a record right now of if the fish participated in the first 3 trials. I only started looking at trial 4. 
  
  
  resolution <- strsplit(file_list[i],'_')[[1]][7]
  
  #converting all the non-1280 resolutions to 1280 as far as x distance goes
  if(resolution == 800){
  df$x <- df$x *1.6}
  if (resolution == 640){
  df$x <- df$x *2}
  max(df$x, na.rm = TRUE)
  
  if(startside == "L"){
    df.full<- full_join(df,shuttleleft, by = 'frame_number')}
  else if(startside == "R"){
    df.full<- full_join(df,shuttleright, by = 'frame_number')}
  
  df.full
  
  df.full<-df.full %>% mutate(distance_from_correct = abs(correct_x_pixel - x))
  df.full.stim<-df.full %>% filter(type == 'stim')
  df.full.gap<-df.full %>% filter(type == 'gap')
  
  df.full.gap1<-df.full.gap %>% filter(is.inrange(presentation, range = c(1,3)))
  df.full.gap2<-df.full.gap %>% filter(is.inrange(presentation, range = c(4,6)))
  df.full.gap3<-df.full.gap %>% filter(is.inrange(presentation, range = c(7,9)))
  df.full.gap4<-df.full.gap %>% filter(is.inrange(presentation, range = c(10,12)))
  df.full.gap5<-df.full.gap %>% filter(is.inrange(presentation, range = c(13,15)))
  df.full.gap6<-df.full.gap %>% filter(is.inrange(presentation, range = c(16,18)))
  df.full.gap7<-df.full.gap %>% filter(is.inrange(presentation, range = c(19,21)))
  df.full.gap8<-df.full.gap %>% filter(is.inrange(presentation, range = c(22,24)))
  df.full.gap9<-df.full.gap %>% filter(is.inrange(presentation, range = c(25,27)))
  df.full.gap10<-df.full.gap %>% filter(is.inrange(presentation, range = c(28,30)))
  
  
df.full.gap<-do.call("rbind", list(df.full.gap1, df.full.gap2, df.full.gap3, df.full.gap4, df.full.gap5, df.full.gap6, df.full.gap7, df.full.gap8, df.full.gap9, df.full.gap10))
  
  df.full.stim1<-df.full.stim %>% filter(is.inrange(presentation, range = c(1,3))) %>% mutate(binned_presentation = 1)
  df.full.stim2<-df.full.stim %>% filter(is.inrange(presentation, range = c(4,6))) %>% mutate(binned_presentation = 2)
  df.full.stim3<-df.full.stim %>% filter(is.inrange(presentation, range = c(7,9))) %>% mutate(binned_presentation = 3)
  df.full.stim4<-df.full.stim %>% filter(is.inrange(presentation, range = c(10,12))) %>% mutate(binned_presentation = 4)
  df.full.stim5<-df.full.stim %>% filter(is.inrange(presentation, range = c(13,15))) %>% mutate(binned_presentation = 5)
  df.full.stim6<-df.full.stim %>% filter(is.inrange(presentation, range = c(16,18))) %>% mutate(binned_presentation = 6)
  df.full.stim7<-df.full.stim %>% filter(is.inrange(presentation, range = c(19,21))) %>% mutate(binned_presentation = 7)
  df.full.stim8<-df.full.stim %>% filter(is.inrange(presentation, range = c(22,24))) %>% mutate(binned_presentation = 8)
  df.full.stim9<-df.full.stim %>% filter(is.inrange(presentation, range = c(25,27))) %>% mutate(binned_presentation = 9)
  df.full.stim10<-df.full.stim %>% filter(is.inrange(presentation, range = c(28,30))) %>% mutate(binned_presentation = 10)
  
  
df.full.stim<-do.call("rbind", list(df.full.stim1, df.full.stim2, df.full.stim3, df.full.stim4, df.full.stim5, df.full.stim6, df.full.stim7, df.full.stim8, df.full.stim9, df.full.stim10))
  
  #This section is getting the proportion of time on the correct side for every presentation (first for gaps and then for stimuli)
  test_column_prop_gap <- vector(length = length(unique(df.full.gap$presentation)))
  df.prop.gap<-data.frame(presentation = test_column_prop_gap)
  
  
  
  #427 is going to be the closest third to the screen (1280 width)
  for(j in 1:length(unique(df.full.gap$presentation))){
    jnum<-as.numeric(j)
    df.prop.gap$presentation[j] <-jnum
    df.full.gap.this.presentation<-df.full.gap %>% filter(presentation == jnum)
    nrow<-df.full.gap %>% filter(presentation == jnum) %>% nrow()
    correct_nrow<-df.full.gap %>% filter(presentation == jnum) %>% filter(distance_from_correct < 427) %>% nrow()
    df.prop.gap$proportion_time_correct_during_gap[j]<-correct_nrow/nrow
    df.prop.gap$average_distance_during_gap[j] <- mean(df.full.gap.this.presentation$distance_from_correct)
  }
  
  test_column_prop_stim <- vector(length = length(unique(df.full.stim$presentation)))
  df.prop.stim<-data.frame(presentation = test_column_prop_stim)
  
  for(j in 1:length(unique(df.full.stim$presentation))){
    jnum<-as.numeric(j)
    df.prop.stim$presentation[j] <-jnum
    df.full.stim.this.presentation<-df.full.stim %>% filter(presentation == jnum)
    nrow<-df.full.stim %>% filter(presentation == jnum) %>% nrow()
    correct_nrow<-df.full.stim %>% filter(presentation == jnum) %>% filter(distance_from_correct < 427) %>% nrow()
    df.prop.stim$proportion_time_correct_during_stim[j]<-correct_nrow/nrow
    df.prop.stim$average_distance_during_stim[j] <- mean(df.full.stim.this.presentation$distance_from_correct)
  }
  
  mean_prop_time_correct_during_gap<-mean(df.prop.gap$proportion_time_correct_during_gap)
  mean_prop_time_correct_during_stim<-mean(df.prop.stim$proportion_time_correct_during_stim)
  
  mean_distance_from_correct_during_gap<-mean(df.prop.gap$average_distance_during_gap)
  mean_distance_from_correct_during_stim<-mean(df.prop.stim$average_distance_during_stim)
  
  df.prop.gap<-df.prop.gap%>% filter(is.na(presentation) == FALSE)
  df.prop.stim<-df.prop.stim%>% filter(is.na(presentation) == FALSE)

  mod<- lm(df.prop.gap$proportion_time_correct_during_gap ~ df.prop.gap$presentation)
  modsum<-summary(mod)
  modsum<-modsum$coefficients
  gap_prop_slope<-modsum[2]
  
  mod<- lm(df.prop.stim$proportion_time_correct_during_stim ~ df.prop.stim$presentation)
  modsum<-summary(mod)
  modsum<-modsum$coefficients
  stim_prop_slope<-modsum[2]
  giveup3minus2 <- giveup3 - 2
  
  
   if(giveup3 > 5){
    df.full.first3gap<-df.full.gap %>% filter(is.inrange(presentation, range = c(1,3)))
    df.full.last3gap<-df.full.gap %>% filter(is.inrange(presentation, range = c(giveup3minus2, giveup3)))
    df.prop.first3gap<-df.prop.gap %>% filter(is.inrange(presentation, range = c(1,3)))
    df.prop.last3gap<-df.prop.gap %>% filter(is.inrange(presentation, range = c(giveup3minus2, giveup3)))

    avg_dist_during_first_3_gaps<- mean(df.full.first3gap$distance_from_correct)
    comp_3v3_avg_dist <- mean(df.full.first3gap$distance_from_correct) - mean(df.full.last3gap$distance_from_correct)
    
    twenty_percent_of_first_3_avg_dist <- (mean(df.full.first3gap$distance_from_correct)) * 0.2
    
    comp_3v3_avg_prop_correct <- mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.last3gap$proportion_time_correct_during_gap)
    

 #here's where I'm going to do the ANOVA comparing the 6 relevant gaps (first 3 and last 3) PROP 
  #I'm also going to do a t test/shapiro where compare the first 3 to the last 3 PROP
  df.prop.first3gap<- df.prop.first3gap %>% mutate(first_or_last = 'first')
  df.prop.last3gap<- df.prop.last3gap %>% mutate(first_or_last = 'last') 
  df.prop.firstANDlast3gap<- rbind(df.prop.first3gap, df.prop.last3gap) 
 
  #here's the ANOVA (kruskal), but this doesnt make sense because I'm not binning so there's only one value per presentation
#df.prop.firstANDlast3gap$presentation<-as.factor(df.prop.firstANDlast3gap$presentation)  
#kruskalfit<-kruskal.test(proportion_time_correct_during_gap ~ presentation, data=df.prop.firstANDlast3gap)
#prop_p_value_kruskal<- kruskalfit$p.value  
     
shapiro<- shapiro.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap) #if it is non-significant, it does not deviate from normality, so use a t test  
prop_p_value_shapiro<- shapiro %>% broom::tidy() %>% select(p.value) %>% unlist
test<-t.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap~df.prop.firstANDlast3gap$first_or_last)
prop_p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap~df.prop.firstANDlast3gap$first_or_last)
prop_p_value_wilcox<-wilcox_test$p.value


#Now I'm going to do the same ANOVA/t-test but use distance from correct screen rather than 
shapiro<- shapiro.test(df.prop.firstANDlast3gap$average_distance_during_gap) #if it is non-significant, it does not deviate from normality, so use a t test  
dist_p_value_shapiro<- shapiro %>% broom::tidy() %>% select(p.value) %>% unlist
test<-t.test(df.prop.firstANDlast3gap$average_distance_during_gap~df.prop.firstANDlast3gap$first_or_last)
dist_p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.prop.firstANDlast3gap$average_distance_during_gap~df.prop.firstANDlast3gap$first_or_last)
dist_p_value_wilcox<-wilcox_test$p.value  

    }
  
  else if(giveup3<=5){
    comp_3v3_avg_dist <- NA
    comp_3v3_avg_prop_correct <- NA
    prop_p_value_shapiro <- NA
    prop_p_value_t <- NA
    prop_p_value_wilcox <- NA
    dist_p_value_shapiro <- NA
    dist_p_value_t <- NA
    dist_p_value_wilcox <- NA
    }

  
 #now let's put it all together
df.sum$fish_name[i] <-fishname
df.sum$shuttlebox_start_side[i] <-startside
df.sum$presentation_when_fish_gave_up3[i] <-giveup3
df.sum$shuttlebox_average_distance_from_correct_stimulus_during_stimulus[i]<-mean_distance_from_correct_during_stim
df.sum$shuttlebox_average_distance_from_correct_stimulus_during_gaps[i]<-mean_distance_from_correct_during_gap
df.sum$shuttlebox_average_proportion_of_time_on_correct_side_during_gaps[i]<- mean_prop_time_correct_during_gap
df.sum$shuttlebox_average_proportion_of_time_on_correct_side_during_stimulus[i]<- mean_prop_time_correct_during_stim

#df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]<- prop_p_value_kruskal
df.sum$prop_shuttlebox_TTEST_p_value_first_and_last_3_gaps[i]<- prop_p_value_t
df.sum$prop_shuttlebox_WILCOX_p_value_first_and_last_3_gaps[i]<- prop_p_value_wilcox 
df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]<- prop_p_value_shapiro

#df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]<- dist_p_value_kruskal
df.sum$dist_shuttlebox_TTEST_p_value_first_and_last_3_gaps[i]<- dist_p_value_t
df.sum$dist_shuttlebox_WILCOX_p_value_first_and_last_3_gaps[i]<- dist_p_value_wilcox 
df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]<- dist_p_value_shapiro
  
#if else statement for should I use t test or wilcox (depends on results of shapiro)  PROP

  if(is.na(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i])== TRUE){
    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- NA}
 else if(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]>0.05){
    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- prop_p_value_t}
  else if(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i] <=0.05){
    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- prop_p_value_wilcox}


#if else statement for should I use t test or wilcox (depends on results of shapiro) DIST 
  if(is.na(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i])== TRUE){
    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- NA}
 else if(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]>0.05){
    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- dist_p_value_t}
  else if(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i] <=0.05){
    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- dist_p_value_wilcox}


  
#add if else statement for is KRUSTAK(ANOVA) significant PROP
#if(df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$prop_was_kruskal_significant[i]<- 0}
#  else if(df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$prop_was_kruskal_significant[i]<-1}
#  else{
#    df.sum$prop_was_kruskal_significant[i]<- NA}
#1 means yes

#add if else statement for is T TEST/WILCOX significant PROP

if(is.na(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i])== TRUE){
    df.sum$prop_was_t_test_wilcox_significant[i]<- NA}
else if(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]>0.05){
    df.sum$prop_was_t_test_wilcox_significant[i]<- 0}
  else if(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i] <=0.05){
    df.sum$prop_was_t_test_wilcox_significant[i]<-1}


#add if else statement for is KRUSTAK(ANOVA) significant DIST
#if(df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$dist_was_kruskal_significant[i]<- 0}
#  else if(df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$dist_was_kruskal_significant[i]<-1}
#  else{
#    df.sum$dist_was_kruskal_significant[i]<- NA}
#1 means yes

#add if else statement for is T TEST/WILCOX significant DIST
if(is.na(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i])== TRUE){
    df.sum$dist_was_t_test_wilcox_significant[i]<- NA}
else if(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]>0.05){
    df.sum$dist_was_t_test_wilcox_significant[i]<- 0}
  else if(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i] <=0.05){
    df.sum$dist_was_t_test_wilcox_significant[i]<-1}


df.sum$average_distance_during_the_first_3_gaps[i]<- avg_dist_during_first_3_gaps
  
df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] <- comp_3v3_avg_dist #so a more positive number is better
#^^this is the continuous metric using the average distance! difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps
df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i] <- comp_3v3_avg_prop_correct #so a more negative number is better because it's the first 3 minus the last 3
#^^this is the continuous metric using the proportion time (also remember being in the "correct" area means it was in the third of the tank closest to the screen! difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps


#the last thing I want to do to assess performance categorically is highlight individuals who had a significant t test AND the performance INCREASED between the beginning and end (i.e. the average distance from correct shrank, and the proportion time on the correct side grew) 
   if(is.na(df.sum$dist_was_t_test_wilcox_significant[i])== TRUE){
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- NA}
   else if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i])== TRUE){
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- NA}
   else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>0 & df.sum$dist_was_t_test_wilcox_significant[i]== 1){
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- 1}
   else{
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- 0}

  if(is.na(df.sum$prop_was_t_test_wilcox_significant[i])== TRUE){
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- NA}
  else if(is.na(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i])== TRUE){
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]<0 & df.sum$prop_was_t_test_wilcox_significant[i]== 1){
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- 1}
  else{
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- 0}


#did proportion time in the correct zone increase by 20% ? (THere's no relative here, only absolute)
  if(is.na(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]<= -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent[i]<- 1}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i] > -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent[i]<- 0}


#did distance from the screen decrease by ABSOLUTE 20% (i.e.256pixels)?
  if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent[i]<- NA}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>= 256){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent[i]<- 1}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] < 256){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent[i]<- 0}



#did distance form the screen decrease by RELATIVE 20% (i.e. the distance the fish started at (avg across the first 3 trials) x 0.2)
  if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent[i]<- NA}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>= twenty_percent_of_first_3_avg_dist){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent[i]<- 1}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] < twenty_percent_of_first_3_avg_dist){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent[i]<- 0}

}

df.sum.90sec<-df.sum
setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/")
#write_csv(df.sum.90sec,'C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Comparative Cognition Shuttlebox Data October 2018 full 90 seconds.csv')

``` 










#OK LAST TIME, NOW ONLY LOOKING AT LAST 10 SECONDS OF GAP!



```{r, echo=FALSE, message=FALSE}


setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets/")

file_list<- list.files("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")


shuttleleft<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_L_framesofinterest.csv", col_names = TRUE, col_types = NULL)
#View(shuttleleft)

shuttleright<- read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Shuttlebox_Tracking_R_framesofinterest.csv", col_names = TRUE, col_types = NULL)
#View(shuttleright)

giveupdoc<-read_csv("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/shuttlebox_giveup_2_and_3.csv", col_names = TRUE, col_types = NULL)

test_column <- vector(length = length(file_list))
df.sum <- data.frame(fish_name = test_column)
```


```{r, echo=FALSE, message=FALSE}
for(i in 1:length(file_list)){
  setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/score sheets")
  
  df<- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  
  fishname <- strsplit(file_list[i],'_')[[1]][4]
  startside <- strsplit(file_list[i],'_')[[1]][5]
  giveup3<-giveupdoc$giveup3[i]
 #giveup 2 is the more restricted version of giveup- this is the last tgap before 3 sequential gaps where the fish did not move. This was judged by the proportion of time on the correct side, if it went 0-100-0 or 100-0-100.
  
  #here's where I'm going to add the giveup3- which is giveup 2 but we only start looking starting on the 4th presentation and we look DURING STIMS not GAPS. The idea is that it might take a while for a fish to not be scared so we're giving them the first 3 trials (i.e. 5 minutes) to get used to it. the first trial that can count towards the giveup is trial 4
  
  #e.g. if 0-100-0 is presentations (stim) 17,18,19, then giveup presentation is 16
  
  #NOTE ABOUT GIVEUP 3- when we use giveup 3 and the 3v3, there are X fish who cannot participate because they don't have 6 ISI's in which to score the first 3 vs the last 3 (i.e. they give up before trial 6)
  
  
  #Now given giveup3, where the fish stops being counted if it doesn't participate for three tirals in a row but only after the first 4, it's easy to say what the last three trials before the giveup are, but what are the first 3? Are they trials 1,2,3 or are they trials 4,5,6? I'm going to use 1,2,3 for now, but understand that I could use 4,5,6. I don't have a record right now of if the fish participated in the first 3 trials. I only started looking at trial 4. 
  
  
  resolution <- strsplit(file_list[i],'_')[[1]][7]
  
  #converting all the non-1280 resolutions to 1280 as far as x distance goes
  if(resolution == 800){
  df$x <- df$x *1.6}
  if (resolution == 640){
  df$x <- df$x *2}
  max(df$x, na.rm = TRUE)
  
  if(startside == "L"){
    df.full<- full_join(df,shuttleleft, by = 'frame_number')}
  else if(startside == "R"){
    df.full<- full_join(df,shuttleright, by = 'frame_number')}
  
  df.full
  
  df.full<-df.full %>% mutate(distance_from_correct = abs(correct_x_pixel - x))
    df.full<-df.full%>%filter(last_10_secs_of_gap == 1) #THIS IS WHAT CHANGES THE WHOLE THING TO FILTER BY LAST 10 SECS
  
  df.full.gap<-df.full %>% filter(type == 'gap')
  
  df.full.gap1<-df.full.gap %>% filter(is.inrange(presentation, range = c(1,3)))
  df.full.gap2<-df.full.gap %>% filter(is.inrange(presentation, range = c(4,6)))
  df.full.gap3<-df.full.gap %>% filter(is.inrange(presentation, range = c(7,9)))
  df.full.gap4<-df.full.gap %>% filter(is.inrange(presentation, range = c(10,12)))
  df.full.gap5<-df.full.gap %>% filter(is.inrange(presentation, range = c(13,15)))
  df.full.gap6<-df.full.gap %>% filter(is.inrange(presentation, range = c(16,18)))
  df.full.gap7<-df.full.gap %>% filter(is.inrange(presentation, range = c(19,21)))
  df.full.gap8<-df.full.gap %>% filter(is.inrange(presentation, range = c(22,24)))
  df.full.gap9<-df.full.gap %>% filter(is.inrange(presentation, range = c(25,27)))
  df.full.gap10<-df.full.gap %>% filter(is.inrange(presentation, range = c(28,30)))
  
  
df.full.gap<-do.call("rbind", list(df.full.gap1, df.full.gap2, df.full.gap3, df.full.gap4, df.full.gap5, df.full.gap6, df.full.gap7, df.full.gap8, df.full.gap9, df.full.gap10))
  
  #This section is getting the proportion of time on the correct side for every presentation (first for gaps and then for stimuli)
  test_column_prop_gap <- vector(length = length(unique(df.full.gap$presentation)))
  df.prop.gap<-data.frame(presentation = test_column_prop_gap)
  
  
  
  #427 is going to be the closest third to the screen (1280 width)
  for(j in 1:length(unique(df.full.gap$presentation))){
    jnum<-as.numeric(j)
    df.prop.gap$presentation[j] <-jnum
    df.full.gap.this.presentation<-df.full.gap %>% filter(presentation == jnum)
    nrow<-df.full.gap %>% filter(presentation == jnum) %>% nrow()
    correct_nrow<-df.full.gap %>% filter(presentation == jnum) %>% filter(distance_from_correct < 427) %>% nrow()
    df.prop.gap$proportion_time_correct_during_gap[j]<-correct_nrow/nrow
    df.prop.gap$average_distance_during_gap[j] <- mean(df.full.gap.this.presentation$distance_from_correct)
  }
  
  mean_prop_time_correct_during_gap<-mean(df.prop.gap$proportion_time_correct_during_gap)
  
  mean_distance_from_correct_during_gap<-mean(df.prop.gap$average_distance_during_gap)
  
  df.prop.gap<-df.prop.gap%>% filter(is.na(presentation) == FALSE)

  mod<- lm(df.prop.gap$proportion_time_correct_during_gap ~ df.prop.gap$presentation)
  modsum<-summary(mod)
  modsum<-modsum$coefficients
  gap_prop_slope<-modsum[2]
  
  giveup3minus2 <- giveup3 - 2
  
  
   if(giveup3 > 5){
    df.full.first3gap<-df.full.gap %>% filter(is.inrange(presentation, range = c(1,3)))
    df.full.last3gap<-df.full.gap %>% filter(is.inrange(presentation, range = c(giveup3minus2, giveup3)))
    df.prop.first3gap<-df.prop.gap %>% filter(is.inrange(presentation, range = c(1,3)))
    df.prop.last3gap<-df.prop.gap %>% filter(is.inrange(presentation, range = c(giveup3minus2, giveup3)))

    avg_dist_during_first_3_gaps<- mean(df.full.first3gap$distance_from_correct)
    comp_3v3_avg_dist <- mean(df.full.first3gap$distance_from_correct) - mean(df.full.last3gap$distance_from_correct)
    
    twenty_percent_of_first_3_avg_dist <- (mean(df.full.first3gap$distance_from_correct)) * 0.2
    
    comp_3v3_avg_prop_correct <- mean(df.prop.first3gap$proportion_time_correct_during_gap) - mean(df.prop.last3gap$proportion_time_correct_during_gap)
    

 #here's where I'm going to do the ANOVA comparing the 6 relevant gaps (first 3 and last 3) PROP 
  #I'm also going to do a t test/shapiro where compare the first 3 to the last 3 PROP
  df.prop.first3gap<- df.prop.first3gap %>% mutate(first_or_last = 'first')
  df.prop.last3gap<- df.prop.last3gap %>% mutate(first_or_last = 'last') 
  df.prop.firstANDlast3gap<- rbind(df.prop.first3gap, df.prop.last3gap) 
 
  #here's the ANOVA (kruskal), but this doesnt make sense because I'm not binning so there's only one value per presentation
#df.prop.firstANDlast3gap$presentation<-as.factor(df.prop.firstANDlast3gap$presentation)  
#kruskalfit<-kruskal.test(proportion_time_correct_during_gap ~ presentation, data=df.prop.firstANDlast3gap)
#prop_p_value_kruskal<- kruskalfit$p.value  
  
  
#The 37th fish in the list,gilly, was spent 0% of her time on the correct side for all 6 "first3 and last3" presentations. This makes the wilcox test mad, so I just hard coded that gilly's statistical test values should be NA
  #The 45th fish, wile, has all his first 3 gaps as 100% and his last 3 gaps as 0%, which is making it hard for the t-test to run, so I just hard coded for wile like i did with gilly
 
    if(i == 37){
  prop_p_value_wilcox<-NA
  dist_p_value_wilcox <- NA
  dist_p_value_shapiro <- NA
  prop_p_value_shapiro <- NA
  dist_p_value_t <- NA
  prop_p_value_t <- NA} 
  
  else if(i == 45){
  prop_p_value_wilcox<-NA
  dist_p_value_wilcox <- NA
  dist_p_value_shapiro <- NA
  prop_p_value_shapiro <- NA
  dist_p_value_t <- NA
  prop_p_value_t <- NA}
  
      else{
shapiro<- shapiro.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap) #if it is non-significant, it does not deviate from normality, so use a t test  
prop_p_value_shapiro<- shapiro %>% broom::tidy() %>% select(p.value) %>% unlist
test<-t.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap~df.prop.firstANDlast3gap$first_or_last)
prop_p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist


  wilcox_test<-wilcox.test(df.prop.firstANDlast3gap$proportion_time_correct_during_gap~df.prop.firstANDlast3gap$first_or_last)
  prop_p_value_wilcox<-wilcox_test$p.value}


#Now I'm going to do the same ANOVA/t-test but use distance from correct screen rather than 
shapiro<- shapiro.test(df.prop.firstANDlast3gap$average_distance_during_gap) #if it is non-significant, it does not deviate from normality, so use a t test  
dist_p_value_shapiro<- shapiro %>% broom::tidy() %>% select(p.value) %>% unlist
test<-t.test(df.prop.firstANDlast3gap$average_distance_during_gap~df.prop.firstANDlast3gap$first_or_last)
dist_p_value_t<- test %>% broom::tidy() %>% select(p.value) %>% unlist
wilcox_test<-wilcox.test(df.prop.firstANDlast3gap$average_distance_during_gap~df.prop.firstANDlast3gap$first_or_last)
dist_p_value_wilcox<-wilcox_test$p.value  

    }
  
  else if(giveup3<=5){
    comp_3v3_avg_dist <- NA
    comp_3v3_avg_prop_correct <- NA
    prop_p_value_shapiro <- NA
    prop_p_value_t <- NA
    prop_p_value_wilcox <- NA
    dist_p_value_shapiro <- NA
    dist_p_value_t <- NA
    dist_p_value_wilcox <- NA
    }

  
 #now let's put it all together
df.sum$fish_name[i] <-fishname
df.sum$shuttlebox_start_side[i] <-startside
df.sum$presentation_when_fish_gave_up3[i] <-giveup3
df.sum$shuttlebox_average_proportion_of_time_on_correct_side_during_gaps[i]<- mean_prop_time_correct_during_gap

#df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]<- prop_p_value_kruskal
df.sum$prop_shuttlebox_TTEST_p_value_first_and_last_3_gaps[i]<- prop_p_value_t
df.sum$prop_shuttlebox_WILCOX_p_value_first_and_last_3_gaps[i]<- prop_p_value_wilcox 
df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]<- prop_p_value_shapiro

#df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]<- dist_p_value_kruskal
df.sum$dist_shuttlebox_TTEST_p_value_first_and_last_3_gaps[i]<- dist_p_value_t
df.sum$dist_shuttlebox_WILCOX_p_value_first_and_last_3_gaps[i]<- dist_p_value_wilcox 
df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]<- dist_p_value_shapiro
  
#if else statement for should I use t test or wilcox (depends on results of shapiro)  PROP

  if(is.na(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i])== TRUE){
    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- NA}
 else if(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]>0.05){
    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- prop_p_value_t}
  else if(df.sum$prop_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i] <=0.05){
    df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- prop_p_value_wilcox}


#if else statement for should I use t test or wilcox (depends on results of shapiro) DIST 
  if(is.na(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i])== TRUE){
    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- NA}
 else if(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i]>0.05){
    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- dist_p_value_t}
  else if(df.sum$dist_shuttlebox_SHAPIRO_p_value_first_and_last_3_gaps[i] <=0.05){
    df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]<- dist_p_value_wilcox}


  
#add if else statement for is KRUSTAK(ANOVA) significant PROP
#if(df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$prop_was_kruskal_significant[i]<- 0}
#  else if(df.sum$prop_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$prop_was_kruskal_significant[i]<-1}
#  else{
#    df.sum$prop_was_kruskal_significant[i]<- NA}
#1 means yes

#add if else statement for is T TEST/WILCOX significant PROP

if(is.na(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i])== TRUE){
    df.sum$prop_was_t_test_wilcox_significant[i]<- NA}
else if(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i]>0.05){
    df.sum$prop_was_t_test_wilcox_significant[i]<- 0}
  else if(df.sum$prop_p_value_of_wilcox_or_t_test_based_on_shapiro[i] <=0.05){
    df.sum$prop_was_t_test_wilcox_significant[i]<-1}


#add if else statement for is KRUSTAK(ANOVA) significant DIST
#if(df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i]>0.05){
#    df.sum$dist_was_kruskal_significant[i]<- 0}
#  else if(df.sum$dist_shuttlebox_KRUSKAL_p_value_first_and_last_3_gaps[i] <=0.05){
#    df.sum$dist_was_kruskal_significant[i]<-1}
#  else{
#    df.sum$dist_was_kruskal_significant[i]<- NA}
#1 means yes

#add if else statement for is T TEST/WILCOX significant DIST
if(is.na(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i])== TRUE){
    df.sum$dist_was_t_test_wilcox_significant[i]<- NA}
else if(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i]>0.05){
    df.sum$dist_was_t_test_wilcox_significant[i]<- 0}
  else if(df.sum$dist_p_value_of_wilcox_or_t_test_based_on_shapiro[i] <=0.05){
    df.sum$dist_was_t_test_wilcox_significant[i]<-1}


df.sum$average_distance_during_the_first_3_gaps[i]<- avg_dist_during_first_3_gaps
  
df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] <- comp_3v3_avg_dist #so a more positive number is better
#^^this is the continuous metric using the average distance! difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps
df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i] <- comp_3v3_avg_prop_correct #so a more negative number is better because it's the first 3 minus the last 3
#^^this is the continuous metric using the proportion time (also remember being in the "correct" area means it was in the third of the tank closest to the screen! difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps


#the last thing I want to do to assess performance categorically is highlight individuals who had a significant t test AND the performance INCREASED between the beginning and end (i.e. the average distance from correct shrank, and the proportion time on the correct side grew) 
   if(is.na(df.sum$dist_was_t_test_wilcox_significant[i])== TRUE){
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- NA}
   else if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i])== TRUE){
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- NA}
   else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>0 & df.sum$dist_was_t_test_wilcox_significant[i]== 1){
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- 1}
   else{
    df.sum$did_fish_increase_avg_dist_performance_by_significant_amount_t_test_wilcox[i]<- 0}

  if(is.na(df.sum$prop_was_t_test_wilcox_significant[i])== TRUE){
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- NA}
  else if(is.na(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i])== TRUE){
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]<0 & df.sum$prop_was_t_test_wilcox_significant[i]== 1){
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- 1}
  else{
    df.sum$did_fish_increase_avg_prop_performance_by_significant_amount_t_test_wilcox[i]<- 0}


#did proportion time in the correct zone increase by 20% ? (THere's no relative here, only absolute)
  if(is.na(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent[i]<- NA}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i]<= -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent[i]<- 1}
  else if(df.sum$difference_avg_prop_correct_first_3_gaps_minus_last_3_gaps[i] > -0.2){
    df.sum$did_fish_solve_shuttlebox_using_prop_correct_increase_of_at_least_20_percent[i]<- 0}


#did distance from the screen decrease by ABSOLUTE 20% (i.e.256pixels)?
  if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent[i]<- NA}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>= 256){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent[i]<- 1}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] < 256){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_ABSOLUTE_20_percent[i]<- 0}



#did distance form the screen decrease by RELATIVE 20% (i.e. the distance the fish started at (avg across the first 3 trials) x 0.2)
  if(is.na(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]) == TRUE){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent[i]<- NA}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i]>= twenty_percent_of_first_3_avg_dist){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent[i]<- 1}
  else if(df.sum$difference_avg_dist_from_correct_first_3_gaps_minus_last_3_gaps[i] < twenty_percent_of_first_3_avg_dist){
    df.sum$did_fish_solve_shuttlebox_using_distance_decrease_of_at_least_RELATIVE_20_percent[i]<- 0}

}

View(df.sum)
df.sum.10sec<-df.sum
setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/")
#write_csv(df.sum.10sec,'C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/Shuttlebox/Comparative Cognition Shuttlebox Data October 2018 10 seconds.csv')

``` 




#Here's a record of the evolution of how we looked at shuttlebox performance:

#1.	Let's look at performance over:
#a.	 the entire ISI (90 seconds)
#b.	The last 30 seconds of the ISI
#c.	The last 10 seconds of the ISI

#2.	And let's measure performance in terms of: 
#a.	A decrease in absolute distance from the screen
#b.	A relative decrease in distance from the screen from where the fish started (averaged across the first 3 gaps) 
#c.	An increase in proportion time in the correct third of the tank <<<(we decided to use this one rather than distance!)

#3.	Let's make a criterion of to be a learner you need to increase your proportion time in the correct third of the tank by 20%, comparing your first three gaps to your last three gaps before you gave up

#4.	Well because learning isn't independent of how long the fish participated, let's add two new criteria:
#a.	Did you increase your prop time by 20% when we compare gaps 123 to 456?
#b.	Did you increase your prop time by 20% when we compare 123 to 6?

#5.	For all three of these new criterion (123 vs last 3, 123 vs 456, and 123 vs 6) we can look at your "speed of learning" i.e. at what ISI did you reach the criterion
#a.	I tried to rank fish by "speed of learning" but it didn't work out because too many fish had the same exact speed

#6.	Ok, now what if instead of thinking about shuttlebox performance as in increase from where you started, we just ask if they ever reach a criterion (independent of how they started?)
#a.	Was the fish in the correct third of the tank for 60% of the ISI for three consecutive ISI's?
#i.	And if so, at what ISI was that criterion met?
#b.	Was the fish in the correct third of the tank for 90% of the ISI for two consecutive ISI's?
#i.	And if so, at what ISI was that criterion met?

#7.	And one more new criterion- let's take a step back from looking at the correct third of the tank and instead restrict it to looking at the closest 10cm to the screen
#a.	Was the fish in the closest 10cm to the correct screen for 50% of the ISI for three consecutive ISI's?
#i.	And if so, at what ISI was that criterion met?







