---
title: "Cowlog Tracker and Handscore Comparison April 2 2018"
author: "Kelly Wallace"
date: "April 2, 2018"
output: html_document
---


As of March 30 2018, the fishtracker developed by Richie outputs summary stats for a given video to a row in "numerosity_log.csv" as well as generates a csv file that mirrors the cowlog we get from hand scores. This most recent session was run on the testing videos for the following fish, to compare to the comparative cognition hand scores I have:
Gary, George, Wheatley, Willis, Wyatt, Gertrude, Winona, Gloria, Gavin, Gabriel, Wilbur, Watson, Gina, Gabi, Garrison, Winnifred, Winter, Waldhura, Gladys, Gretchen, Wade, Warren, Gemma, Wildflower, Wisteria, Gibson, Gordon, Wile, Wahida, Waverly, Wedelia, Gideon, Grayson, Griffin (n = 34 X 9 videos per fish = 306 videos)

IMPORTANT: there is no filtering of 30 seconds in either hand or tracck score sheets. They all start at zero. The tracker cowlogs all cut off at 240.04 so I'm doin gthe same fo rthe hand scores

The final dataframe should have one row per video, and should have these columns:
vidID
fishname
sex
day
trial
hand_scorer
left_stim
right_stim

hand_number_entries
track_number_entries
diff_number_entries

hand_total_time
track_total_time
diff_total_time

hand_seconds_center
track_seconds_center
diff_seconds_center


hand_seconds_leftscreen
track_seconds_leftscreen
diff_seconds_leftscreen

hand_seconds_rightscreen
track_seconds_rightscreen
diff_seconds_rightscreen

hand_seconds_total_mirror
track_seconds_total_mirror
diff_seconds_total_mirror

hand_seconds_total_thigmo
track_seconds_total_thigmo
diff_seconds_total_thigmo

Then I'll get the average differences for each area, split it out by sex, as well as get proportional differences

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(rmarkdown)
library(knitr)
library(readr)
library(utils)


#NOTE: make sure to either comment or leave in the "filter out before T30" so the hand and track match. 

```



```{r, message=FALSE, warning=FALSE}
hand_file_list <- list.files("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/numerosity cc score sheets", pattern = "*.csv")
track_file_list <-list.files("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/richie_cowlogs_from_tracker/use_for_comparison", pattern = "*.csv")

hand_test_column <- vector(length = length(hand_file_list))
df.hand<- data.frame(fishname = hand_test_column)

track_test_column <- vector(length = length(track_file_list))
df.track<- data.frame(vidID = track_test_column)


```


```{r, message=FALSE, warning=FALSE}

for(i in 1:length(hand_file_list)){
  setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/numerosity cc score sheets")
  
  fil <- read_csv(hand_file_list[i], col_names = TRUE, col_types = NULL)
  filename <- hand_file_list[i]
  filename<-strsplit(filename, ".csv")[[1]][1]
  filename 
  filename.scorername<-strsplit(filename, "_")[[1]][3]
  filename.scorername
  filename.fishname<-strsplit(filename, "_")[[1]][4]
  filename.fishname<-gsub(" ", "", filename.fishname)
  filename.fishname
  filename.day<-strsplit(filename, "_")[[1]][5]
  filename.day
  filename.trial<-strsplit(filename, "_")[[1]][6]
  filename.trial
  filename.rightstim<-strsplit(filename, "_")[[1]][7]
  filename.rightstim
  filename.leftstim<-strsplit(filename, "_")[[1]][8]
  filename.leftstim
  filename.sex<-strsplit(filename, "_")[[1]][11]
  filename.sex

  filename.vidID<-combine(filename.fishname, filename.day, filename.trial)
  filename.vidID<-paste(filename.vidID, collapse="")
  filename.vidID<-tolower(filename.vidID)
  
  fil$code<-gsub(" ", "", fil$code)
  fil$code<-tolower(fil$code)
  fil.entries<-nrow(fil)
  
  change_index <- which(fil$time > 240.04)[1]-1
  fil$time[change_index]<- 240.04
  fil<-filter(fil, time <= 240.04)
  
  #COMMENT OUT if you are looking at T0-30!!!!!
  change_index <- which(fil$time > 30)[1]-1
  fil$time[change_index]<- 30
  fil<-filter(fil, time >= 30)
  
  fil<-mutate(fil, time.difference = -(time -lead(time)))
  fil$time.difference <- replace(fil$time.difference, c(1), (fil$time[2])) #use only if you're starting at time = 0 seconds
  
  fil.end<-fil[fil$code == "end",]
  fil.center<-fil[fil$code == "center",]
  fil.leftscreen<-fil[fil$code == "leftscreen",]
  fil.rightscreen<-fil[fil$code == "rightscreen",]
  fil.topleftthigmo<-fil[fil$code == "topleftthigmo",]
  fil.toprightthigmo<-fil[fil$code == "toprightthigmo",]
  fil.bottomleftthigmo<-fil[fil$code == "bottomleftthigmo",]
  fil.bottomrightthigmo<-fil[fil$code == "bottomrightthigmo",]
  fil.topmirror<-fil[fil$code == "topmirror",]
  fil.bottommirror<-fil[fil$code == "bottommirror",]
  
  df.hand$fishname[i]<-filename.fishname
  df.hand$fishname[i]<-tolower(df.hand$fishname[i])
  df.hand$sex[i]<- filename.sex
  df.hand$hand_scorer_name[i]<-filename.scorername
  df.hand$day[i]<-filename.day
  df.hand$trial[i]<-filename.trial
  df.hand$vidID[i]<-filename.vidID

  df.hand$hand_number_entries[i]<-fil.entries -1
  df.hand$hand_total_time[i]<-(sum(fil.end$time))
  
  if(df.hand$hand_total_time[i] == 0){
  df.hand$hand_total_time[i]<-240.04}
  else{
  df.hand$hand_total_time[i]<-df.hand$hand_total_time[i]}

  
  df.hand$hand_seconds_center[i]<-sum(fil.center$time.difference)
  
  df.hand$hand_seconds_leftscreen[i]<-sum(fil.leftscreen$time.difference) 
  df.hand$hand_seconds_rightscreen[i]<-sum(fil.rightscreen$time.difference)
  
  df.hand$hand_seconds_center[is.na(df.hand$hand_seconds_center)] <- 0
  df.hand$hand_seconds_leftscreen[is.na(df.hand$hand_seconds_leftscreen)] <- 0
  df.hand$hand_seconds_rightscreen[is.na(df.hand$hand_seconds_rightscreen)] <- 0
  
  topleft_thigmo_sum <- sum(fil.topleftthigmo$time.difference, na.rm = TRUE)
  topright_thigmo_sum <- sum(fil.toprightthigmo$time.difference, na.rm = TRUE)
  bottomleft_thigmo_sum <- sum(fil.bottomleftthigmo$time.difference, na.rm = TRUE)
  bottomright_thigmo_sum <- sum(fil.bottomrightthigmo$time.difference, na.rm = TRUE)
  top_mirror <- sum(fil.topmirror$time.difference, na.rm = TRUE)
  bottom_mirror<- sum(fil.bottommirror$time.difference, na.rm = TRUE)
  
df.hand$hand_seconds_total_thigmo[i]<- (topleft_thigmo_sum + topright_thigmo_sum + bottomleft_thigmo_sum + bottomright_thigmo_sum)
df.hand$hand_seconds_total_mirror[i]<- (top_mirror + bottom_mirror)
}

View(df.hand)

```

```{r, message=FALSE, warning=FALSE}

for(i in 1:length(track_file_list)){
  setwd("C:/Users/Kelly/Desktop/Grad School/Cummings Lab/Comparative Cognition/richie_cowlogs_from_tracker/use_for_comparison")
  
  fil <- read_csv(track_file_list[i], col_names = TRUE, col_types = NULL)
  filename <- track_file_list[i]
  filename<-strsplit(filename, ".csv")[[1]][1]
  filename 
  filename.fishname<-strsplit(filename, "_")[[1]][5]
  filename.fishname<-gsub(" ", "", filename.fishname)
  filename.fishname
  filename.day<-strsplit(filename, "_")[[1]][6]
  filename.day
  filename.trial<-strsplit(filename, "_")[[1]][7]
  filename.trial

  filename.vidID<-combine(filename.fishname, filename.day, filename.trial)
  filename.vidID<-paste(filename.vidID, collapse="")
  filename.vidID<-tolower(filename.vidID)
  
  fil$code<-gsub(" ", "", fil$code)
  fil$code<-tolower(fil$code)
  fil.entries<-nrow(fil)
  
  fil<-mutate(fil, time.difference = -(time -lead(time)))
  fil$time.difference <- replace(fil$time.difference, c(1), (fil$time[2])) #use only if you're starting at time = 0 seconds
  
  fil.end<-fil[fil$code == "end",]
  fil.center<-fil[fil$code == "center",]
  fil.leftscreen<-fil[fil$code == "leftscreen",]
  fil.rightscreen<-fil[fil$code == "rightscreen",]
  fil.topleftthigmo<-fil[fil$code == "topleftthigmo",]
  fil.toprightthigmo<-fil[fil$code == "toprightthigmo",]
  fil.bottomleftthigmo<-fil[fil$code == "bottomleftthigmo",]
  fil.bottomrightthigmo<-fil[fil$code == "bottomrightthigmo",]
  fil.topmirror<-fil[fil$code == "topmirror",]
  fil.bottommirror<-fil[fil$code == "bottommirror",]
  
  df.track$vidID[i]<-tolower(filename.vidID)

  df.track$track_number_entries[i]<-fil.entries -1
  #df.track$track_total_time[i]<-fil.end[1]
  df.track$track_total_time[i]<-sum(fil.end$time)
  
  df.track$track_seconds_center[i]<-sum(fil.center$time.difference)
  
  df.track$track_seconds_leftscreen[i]<-sum(fil.leftscreen$time.difference) 
  df.track$track_seconds_rightscreen[i]<-sum(fil.rightscreen$time.difference)
  
  df.track$track_seconds_center[is.na(df.track$track_seconds_center)] <- 0
  df.track$track_seconds_leftscreen[is.na(df.track$track_seconds_leftscreen)] <- 0
  df.track$track_seconds_rightscreen[is.na(df.track$track_seconds_rightscreen)] <- 0

  topleft_thigmo_sum <- sum(fil.topleftthigmo$time.difference, na.rm = TRUE)
  topright_thigmo_sum <- sum(fil.toprightthigmo$time.difference, na.rm = TRUE)
  bottomleft_thigmo_sum <- sum(fil.bottomleftthigmo$time.difference, na.rm = TRUE)
  bottomright_thigmo_sum <- sum(fil.bottomrightthigmo$time.difference, na.rm = TRUE)
  top_mirror <- sum(fil.topmirror$time.difference, na.rm = TRUE)
  bottom_mirror<- sum(fil.bottommirror$time.difference, na.rm = TRUE)
  
df.track$track_seconds_total_thigmo[i]<- (topleft_thigmo_sum + topright_thigmo_sum + bottomleft_thigmo_sum + bottomright_thigmo_sum)
df.track$track_seconds_total_mirror[i]<- (top_mirror + bottom_mirror)

}
View(df.track)

```


```{r, message=FALSE, warning=FALSE}

df.both<- left_join(df.hand, df.track, by = "vidID")
View(df.both)

for(i in 1:nrow(df.both)){

    diff_number_entries<- df.both$hand_number_entries[i] - df.both$track_number_entries[i]
    diff_total_time<- df.both$hand_total_time[i] - df.both$track_total_time[i]
    diff_seconds_leftscreen<- df.both$hand_seconds_leftscreen[i] - df.both$track_seconds_leftscreen[i]
    diff_seconds_rightscreen<- df.both$hand_seconds_rightscreen[i] - df.both$track_seconds_rightscreen[i]
    diff_seconds_center<- df.both$hand_seconds_center[i] - df.both$track_seconds_center[i]
    diff_seconds_total_thigmo<- df.both$hand_seconds_total_thigmo[i] - df.both$track_seconds_total_thigmo[i]
    diff_seconds_total_mirror<- df.both$hand_seconds_total_mirror[i] - df.both$track_seconds_total_mirror[i]
    
if(is.na(diff_number_entries) == TRUE){
  df.both$diff_number_entries[i]<-NA}
else{
  df.both$diff_number_entries[i]<-diff_number_entries} 
    
if(is.na(diff_total_time) == TRUE){
  df.both$diff_total_time[i]<-NA}
else{
  df.both$diff_total_time[i]<-diff_total_time}     

if(is.na(diff_seconds_leftscreen) == TRUE){
  df.both$diff_seconds_leftscreen[i]<-NA}
else{
  df.both$diff_seconds_leftscreen[i]<-diff_seconds_leftscreen}     

if(is.na(diff_seconds_rightscreen) == TRUE){
  df.both$diff_seconds_rightscreen[i]<-NA}
else{
  df.both$diff_seconds_rightscreen[i]<-diff_seconds_rightscreen}        
        
if(is.na(diff_seconds_center) == TRUE){
  df.both$diff_seconds_center[i]<-NA}
else{
  df.both$diff_seconds_center[i]<-diff_seconds_center}   
    
if(is.na(diff_seconds_total_thigmo) == TRUE){
  df.both$diff_seconds_total_thigmo[i]<-NA}
else{
  df.both$diff_seconds_total_thigmo[i]<-diff_seconds_total_thigmo} 
    
if(is.na(diff_seconds_total_mirror) == TRUE){
  df.both$diff_seconds_total_mirror[i]<-NA}
else{
  df.both$diff_seconds_total_mirror[i]<-diff_seconds_total_mirror}     
    
}


View(df.both)

```

Now time for some summary stats
```{r}
#General difference between hand score and track (note it's always hand - track, so a positive value means the hand score picked the fish up there for longer/ more entries)

df.both.male<-filter(df.both, df.both$sex == "M")
df.both.female<-filter(df.both, df.both$sex == "F")

mean(df.both$diff_number_entries, na.rm = TRUE)
mean(df.both$diff_total_time, na.rm = TRUE)
mean(df.both$hand_total_time, na.rm = TRUE)
mean(df.both$diff_seconds_leftscreen, na.rm = TRUE)
mean(df.both$diff_seconds_rightscreen, na.rm = TRUE)
mean(df.both$diff_seconds_center, na.rm = TRUE)
mean(df.both$diff_seconds_total_thigmo, na.rm = TRUE)
mean(df.both$diff_seconds_total_mirror, na.rm = TRUE)

mean(df.both.female$diff_number_entries, na.rm = TRUE)
mean(df.both.female$diff_total_time, na.rm = TRUE)
mean(df.both.female$hand_total_time, na.rm = TRUE)
mean(df.both.female$diff_seconds_leftscreen, na.rm = TRUE)
mean(df.both.female$diff_seconds_rightscreen, na.rm = TRUE)
mean(df.both.female$diff_seconds_center, na.rm = TRUE)
mean(df.both.female$diff_seconds_total_thigmo, na.rm = TRUE)
mean(df.both.female$diff_seconds_total_mirror, na.rm = TRUE)

mean(df.both.male$diff_number_entries, na.rm = TRUE)
mean(df.both.male$diff_total_time, na.rm = TRUE)
mean(df.both.male$hand_total_time, na.rm = TRUE)
mean(df.both.male$diff_seconds_leftscreen, na.rm = TRUE)
mean(df.both.male$diff_seconds_rightscreen, na.rm = TRUE)
mean(df.both.male$diff_seconds_center, na.rm = TRUE)
mean(df.both.male$diff_seconds_total_thigmo, na.rm = TRUE)
mean(df.both.male$diff_seconds_total_mirror, na.rm = TRUE)

#Same comparisons, but the absolute value to get the magnitude difference
mean(abs(df.both$diff_number_entries), na.rm = TRUE)
mean(abs(df.both$diff_total_time), na.rm = TRUE)
mean(abs(df.both$hand_total_time), na.rm = TRUE)
mean(abs(df.both$diff_seconds_leftscreen), na.rm = TRUE)
mean(abs(df.both$diff_seconds_rightscreen), na.rm = TRUE)
mean(abs(df.both$diff_seconds_center), na.rm = TRUE)
mean(abs(df.both$diff_seconds_total_thigmo), na.rm = TRUE)
mean(abs(df.both$diff_seconds_total_mirror), na.rm = TRUE)


#Now lets look just at the females, taking the ABSOLUTE difference
mean(abs(df.both.female$diff_number_entries), na.rm = TRUE)
mean(abs(df.both.female$diff_total_time), na.rm = TRUE)
mean(abs(df.both.female$hand_total_time), na.rm = TRUE)
mean(abs(df.both.female$diff_seconds_leftscreen), na.rm = TRUE)
mean(abs(df.both.female$diff_seconds_rightscreen), na.rm = TRUE)
mean(abs(df.both.female$diff_seconds_center), na.rm = TRUE)
mean(abs(df.both.female$diff_seconds_total_thigmo), na.rm = TRUE)
mean(abs(df.both.female$diff_seconds_total_mirror), na.rm = TRUE)


#now lets look just at the males, taking the ABSOLUTE difference
mean(abs(df.both.male$diff_number_entries), na.rm = TRUE)
mean(abs(df.both.male$diff_total_time), na.rm = TRUE)
mean(abs(df.both.male$hand_total_time), na.rm = TRUE)
mean(abs(df.both.male$diff_seconds_leftscreen), na.rm = TRUE)
mean(abs(df.both.male$diff_seconds_rightscreen), na.rm = TRUE)
mean(abs(df.both.male$diff_seconds_center), na.rm = TRUE)
mean(abs(df.both.male$diff_seconds_total_thigmo), na.rm = TRUE)
mean(abs(df.both.male$diff_seconds_total_mirror), na.rm = TRUE)



#Differences between the sexes (male minus female, so if it's positive it means the male had the higher error) error= difference between hand score and tracker
mean(df.both.male$diff_number_entries, na.rm = TRUE) - mean(df.both.female$diff_number_entries, na.rm = TRUE)

mean(df.both.male$diff_seconds_leftscreen, na.rm = TRUE)- mean(df.both.female$diff_seconds_leftscreen, na.rm = TRUE)
mean(df.both.male$diff_seconds_rightscreen, na.rm = TRUE) - mean(df.both.female$diff_seconds_rightscreen, na.rm = TRUE)
mean(df.both.male$diff_seconds_center, na.rm = TRUE) - mean(df.both.female$diff_seconds_center, na.rm = TRUE)

mean(df.both.male$diff_seconds_total_thigmo, na.rm = TRUE) - mean(df.both.female$diff_seconds_total_thigmo, na.rm = TRUE)
mean(df.both.male$diff_seconds_total_mirror, na.rm = TRUE) - mean(df.both.female$diff_seconds_total_mirror, na.rm = TRUE)


#Now we'll do the same thing as absolute above, but take medians:



#Same comparisons, but the absolute value to get the magnitude difference
median(abs(df.both$diff_number_entries), na.rm = TRUE)
median(abs(df.both$diff_total_time), na.rm = TRUE)
median(abs(df.both$hand_total_time), na.rm = TRUE)
median(abs(df.both$diff_seconds_leftscreen), na.rm = TRUE)
median(abs(df.both$diff_seconds_rightscreen), na.rm = TRUE)
median(abs(df.both$diff_seconds_center), na.rm = TRUE)
median(abs(df.both$diff_seconds_total_thigmo), na.rm = TRUE)
median(abs(df.both$diff_seconds_total_mirror), na.rm = TRUE)


#Now lets look just at the females, taking the ABSOLUTE difference
median(abs(df.both.female$diff_number_entries), na.rm = TRUE)
median(abs(df.both.female$diff_total_time), na.rm = TRUE)
median(abs(df.both.female$hand_total_time), na.rm = TRUE)
median(abs(df.both.female$diff_seconds_leftscreen), na.rm = TRUE)
median(abs(df.both.female$diff_seconds_rightscreen), na.rm = TRUE)
median(abs(df.both.female$diff_seconds_center), na.rm = TRUE)
median(abs(df.both.female$diff_seconds_total_thigmo), na.rm = TRUE)
median(abs(df.both.female$diff_seconds_total_mirror), na.rm = TRUE)


#now lets look just at the males, taking the ABSOLUTE difference
median(abs(df.both.male$diff_number_entries), na.rm = TRUE)
median(abs(df.both.male$diff_total_time), na.rm = TRUE)
median(abs(df.both.male$hand_total_time), na.rm = TRUE)
median(abs(df.both.male$diff_seconds_leftscreen), na.rm = TRUE)
median(abs(df.both.male$diff_seconds_rightscreen), na.rm = TRUE)
median(abs(df.both.male$diff_seconds_center), na.rm = TRUE)
median(abs(df.both.male$diff_seconds_total_thigmo), na.rm = TRUE)
median(abs(df.both.male$diff_seconds_total_mirror), na.rm = TRUE)



#WRITING CSV
#write_csv(df.both, "Tracker comparison to hand scores april 4 2018.csv")
```












